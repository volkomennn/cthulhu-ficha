<!DOCTYPE html>
<html lang="pt-br">
<head>
<title>Call of Cthulhu</title>

    <link rel="icon" type="image/png" href="https://i.pinimg.com/736x/fb/5c/86/fb5c86a810c4c761a4f041a30c5d967c.jpg">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investigador Call of Cthulhu</title>
    <style>


.main-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-top: 1px solid #444;
    margin-top: 30px;
    background: rgba(0, 0, 0, 0.3);
}

.footer-left {
    display: flex;
    align-items: center;
    gap: 15px;
}

/* Recorte circular da foto */
.footer-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #666;
}

.footer-info {
    font-size: 0.9em;
    color: #ccc;
}

/* Links empilhados √† direita */
.footer-right {
    display: flex;
    flex-direction: column;
    gap: 8px;
    text-align: left;
}

.social-link {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #aaa;
    text-decoration: none;
    font-size: 0.85em;
    transition: color 0.3s;
}

.social-link:hover {
    color: #d5b6bb;
}

/* Tamanho das mini logos sociais */
.social-icon {
    width: 18px;
    height: 18px;
    object-fit: contain;
    filter: grayscale(100%); /* Ficam cinzas at√© passar o mouse */
}

.social-link:hover .social-icon {
    filter: none;
}


/* Esta classe s√≥ trava o scroll se o modal estiver aberto */
body.modal-open {
    overflow: hidden !important;
    height: 100vh !important;
}

/* Garante que o container das per√≠cias e arsenal n√£o suma */
#periciasContainer {
    display: flex !important;
    flex-direction: row !important; /* Lado a lado */
    flex-wrap: wrap; /* Permite quebrar linha em telas pequenas */
    gap: 20px;
    justify-content: space-between;
    width: 100%;
}

/* Garante que cada tabela ocupe metade (ou quase metade) da largura */
.pericias-table {
    flex: 1;
    min-width: 300px; /* Largura m√≠nima para n√£o esmagar no celular */
    border-collapse: collapse;
}


.modal-overlay {
    position: fixed !important; /* O !important garante que nada sobressaia */
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    background: rgba(0, 0, 0, 0.95); /* Fundo bem escuro */
    display: none; /* O JS vai mudar para 'flex' */
    z-index: 100000; /* Um valor extremo para ficar na frente de tudo */
    align-items: center;
    justify-content: center;
    margin: 0;
    padding: 0;
}

.modal-box {
    background: #080808;
    border: 2px solid #721717;
    width: 85%;
    max-width: 500px;
    max-height: 85vh;
    box-shadow: 0 0 50px rgba(104, 7, 7, 0.3);
    /* Garante que a caixa n√£o herde margens que a empurrem para baixo */
    margin: auto; 
    display: flex !important; /* Garante que a caixa se comporte como flex */
    flex-direction: column;
    min-height: 200px; /* Garante um tamanho m√≠nimo */
}

.modal-header {
    background: #111; padding: 10px; display: flex; justify-content: space-between;
    border-bottom: 1px solid #333; font-family: monospace; color: #721717;
}

.ocupacoes-grid {
    display: grid; 
    grid-template-columns: 1fr 1fr; 
    gap: 10px;
    padding: 20px; 
    overflow-y: auto !important; /* Garante que a lista role dentro do modal */
    flex-grow: 1; /* Faz o grid ocupar o espa√ßo dispon√≠vel */
}

.btn-ocupacao-item {
    background: #0a0a0a; border: 1px solid #222; color: #888;
    padding: 10px; text-align: left; cursor: pointer;
    font-size: 11px; transition: 0.2s; text-transform: uppercase;
}

.btn-ocupacao-item:hover {
    border-color: #ffffff; color: #ffffff; background: #1f0101;
}


/* Container principal precisa ser relativo */
.investigadores-panel {
    position: relative;
    transition: all 0.4s ease-in-out;
    overflow: hidden;
    min-height: 40px; /* Altura m√≠nima da barra quando minimizado */
}

/* Bot√£o de janelinha para o painel de fichas */
.btn-janelinha-fichas {
    position: absolute;
    top: 8px;
    left: 8px;
    background: transparent;
    border: 1px solid #333;
    color: #444;
    font-size: 10px;
    cursor: pointer;
    z-index: 30;
    padding: 2px 5px;
}

.btn-janelinha-fichas:hover {
    color: #ffffff;
    border-color: #000000;
}

/* Classe de minimiza√ß√£o do painel */
.panel-minimizado {
    height: 40px !important;
    width: 200px !important; /* Encolhe a largura tamb√©m */
    padding: 0 10px !important;
    opacity: 0.8;
}

.panel-minimizado .panel-content {
    display: none !important;
}


/* Container precisa de posi√ß√£o relativa para o bot√£o se prender a ele */
.music-player-container {
    position: relative;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    overflow: hidden;
}

/* O bot√£o de janelinha */
.btn-janelinha {
    position: absolute;
    top: 5px;
    left: 5px;
    background: transparent;
    border: 1px solid #444;
    color: #666;
    font-size: 10px;
    cursor: pointer;
    z-index: 20;
    padding: 2px 5px;
    transition: 0.2s;
}

.btn-janelinha:hover {
    color: #00ff00;
    border-color: #00ff00;
}

/* Classe de minimiza√ß√£o */
.player-minimizado {
    width: 60px !important;
    height: 30px !important;
    padding: 0 !important;
    border-color: #222 !important;
}

.player-minimizado .player-content {
    display: none; /* Esconde tudo quando minimizado */
}


        /* TELA DE LOGIN E CADASTRO ADICIONADA */
        #login-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: #000;
    z-index: 20000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start; /* <<< TOPO */
    transition: 1s ease;

    /* MENU DE FICHAS - SLIDE ANIMATION */
.investigadores-panel {
    position: fixed;
    top: 0;
    right: -320px; /* Come√ßa escondido √† direita */
    width: 300px;
    height: 100vh;
    background: rgba(5, 5, 5, 0.98);
    border-left: 2px solid #333;
    padding: 30px 20px;
    z-index: 15000;
    transition: right 0.6s cubic-bezier(0.19, 1, 0.22, 1);
    box-shadow: -10px 0 30px rgba(0,0,0,0.8);
    display: flex;
    flex-direction: column;
}

.modal-overlay {
    /* Troque absolute por fixed */
    position: fixed; 
    top: 0;
    left: 0;
    width: 100vw;   /* Ocupa toda a largura da janela visual */
    height: 100vh;  /* Ocupa toda a altura da janela visual */
    background: rgba(0, 0, 0, 0.9); /* Fundo semi-transparente */
    display: none;
    z-index: 99999; /* Valor bem alto para ficar na frente de TUDO */
    align-items: center;
    justify-content: center;
    overflow: hidden; /* Impede que a p√°gina atr√°s role enquanto o modal est√° aberto */
}

/* Janela centralizada */
.modal-content {
    background: #050505 !important;
    border: 1px solid #00ff00 !important;
    padding: 30px !important;
    width: 450px !important;
    max-width: 90% !important;
    border-radius: 8px !important;
    box-shadow: 0 0 50px rgba(0, 255, 0, 0.2) !important;
    color: #ccc !important;
    pointer-events: auto !important; /* Garante que os cliques funcionem */
}

.modal-header {
    color: #00ff00;
    text-align: center;
    font-weight: bold;
    margin-bottom: 20px;
    border-bottom: 1px solid #222;
    padding-bottom: 10px;
}

.modal-text p {
    font-size: 13px;
    color: #ccc;
    line-height: 1.5;
    margin-bottom: 15px;
}

.btn-close-modal {
    width: 100%;
    padding: 10px;
    background: #111;
    color: #00ff00;
    border: 1px solid #00ff00;
    cursor: pointer;
    margin-top: 10px;
}

/* Estilo do bot√£o "Como usar?" na ficha */
.btn-ajuda-top {
    position: absolute;
    top: 30px; /* ‚Üê MUDEI DE 20px PARA 30px */
    right: 30px; /* ‚Üê MUDEI DE 20px PARA 30px */
    font-size: 10px;
    background: #003300;
    border: 1px solid #00ff00;
    color: #00ff00;
    padding: 8px 16px; /* ‚Üê AUMENTEI O PADDING */
    cursor: pointer;
    z-index: 100;
    text-transform: uppercase;
    font-weight: bold;
    letter-spacing: 1px; /* ‚Üê ADICIONEI */
}


.investigadores-panel.active {
    right: 0; /* Desliza para a tela */
}

/* Esconder o container da ficha enquanto o menu estiver aberto */
/* For√ßa a ficha a ficar invis√≠vel e n√£o ocupar espa√ßo */
/* Esconde a ficha e o player de m√∫sica inicialmente */
.main-content, #player-musica { 
    display: none !important; 
}

/* Classe para mostrar os elementos quando necess√°rio */
.visible {
    display: block !important;
}

/* Centraliza o Menu de Arquivos no meio da tela ap√≥s o login */
.investigadores-panel {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9); /* Centralizado e levemente menor */
    width: 350px;
    background: #050505;
    border: 1px solid #222;
    padding: 30px;
    z-index: 10000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.5s ease;
}

/* Quando o menu estiver ativo, ele aparece suavemente */
.investigadores-panel.active {
    opacity: 1;
    visibility: visible;
    transform: translate(-50%, -50%) scale(1);
}

.empty-msg {
    color: #444;
    text-align: center;
    font-style: italic;
    margin-top: 50px;
    font-size: 0.8em;
}

.menu-footer {
    margin-top: auto;
    padding-top: 20px;
    border-top: 1px solid #222;
}

.investigador-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
    border-bottom: 1px solid #1a1a1a;
    padding: 15px 0;
}

.inv-actions {
    display: flex;
    gap: 5px;
}

.btn-rename { background: #222200; color: #ffff00; font-size: 9px; }
}

        .login-card {
            background: #0d0d0d;
            padding: 40px;
            border: 1px solid #222;
            text-align: center;
            box-shadow: 0 0 50px rgba(0,0,0,1);
            max-width: 400px;
            width: 90%;
            
        }

        .login-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
        }

        .tab-btn {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            color: #444;
            cursor: pointer;
            font-size: 0.7em;
            letter-spacing: 2px;
        }

        .tab-btn.active {
            color: #fff;
            border-bottom: 2px solid #fff;
        }

        .input-group {
            margin-bottom: 15px;
            text-align: left;
        }

        /* ANIMA√á√ïES DE ENTRADA */
        @keyframes fadeInTotal {
            from { opacity: 0; filter: blur(10px); }
            to { opacity: 1; filter: blur(0); }
        }

        @keyframes subirEntrada {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .val-auto {
            background: rgba(255, 255, 255, 0.05) !important;
            color: #777 !important;
            font-style: italic;
            cursor: not-allowed;
        }

        /* EST√âTICA NOIR EXUBERANTE */
        body { 
            font-family: 'Garamond', serif; 
            background-color: #050505; 
            background-image: radial-gradient(circle at center, #1a1a1a 0%, #050505 100%);
            color: #f2f2f2; 
            padding: 20px; 
            line-height: 1.6; 
            overflow-x: hidden;
            opacity: 0;
            animation: fadeInTotal 2s ease-out forwards;
        }

        /* FUNDO DE QUADRADOS SUBINDO */
        #bg-particles {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .square {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            bottom: -50px;
            animation: sobeQuadradinho 12s linear infinite;
        }

        @keyframes sobeQuadradinho {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.2; }
            90% { opacity: 0.2; }
            100% { transform: translateY(-120vh) rotate(720deg); opacity: 0; }
        }

        /* PLAYER E GIF */
        .music-player-container {
            position: fixed;
            top: 20px; 
            left: 20px; 
            z-index: 1000;
            background: rgba(0,0,0,0.95);
            padding: 30px; 
            border: 2px solid #333; 
            text-align: center;
            box-shadow: 0 0 40px rgba(0,0,0,1);
            animation: subirEntrada 1.5s ease-out 0.8s forwards;
            opacity: 0;
            width: 260px;
        }

        .gif-musica {
            width: 220px; 
            margin-bottom: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            filter: grayscale(100%) contrast(1.2);
            border: 1px solid #222;
        }

        /* CONTAINER DA FICHA */
        .container { 
            
            max-width: 950px; 
            margin: 40px auto; 
            background: #0d0d0d; 
            padding: 40px; 
            border: 1px solid #2a2a2a; 
            box-shadow: 0 0 60px rgba(0,0,0,1), inset 0 0 20px rgba(255,255,255,0.02);
            position: relative;
            z-index: 1;
        }

        

        .container::before {
            content: "";
            position: absolute;
            top: 10px; left: 10px; right: 10px; bottom: 10px;
            border: 1px solid #1a1a1a;
            pointer-events: none;
        }

        .logo-projeto { 
            display: block; 
            margin: 0 auto 30px; 
            width: 160px; 
            height: 160px; 
            object-fit: cover; 
            border-radius: 50%; 
            filter: brightness(1.1) contrast(1.1);
            border: 3px solid #222;
            padding: 5px; 
            background: linear-gradient(145deg, #111, #000);
            box-shadow: 0 0 20px rgba(0,0,0,0.8), inset 0 0 10px rgba(255,255,255,0.05);
        }

        h1, h2, h3 { 
    text-align: center; 
    color: #ffffff; 
    text-transform: uppercase; 
    letter-spacing: 5px; 
    font-weight: 300;
    margin-bottom: 35px; /* ‚Üê MUDEI DE 25px PARA 35px */
    border-bottom: 1px solid #333;
    display: block;
    padding-bottom: 15px; /* ‚Üê MUDEI DE 10px PARA 15px */
}

        .section { 
            margin-bottom: 35px; 
            padding: 25px; 
            border: 1px solid #222; 
            background: rgba(20, 20, 20, 0.8);
            box-shadow: 5px 5px 15px rgba(0,0,0,0.5);
        }

        .header-ficha { 
    display: flex; 
    gap: 30px; 
    flex-wrap: wrap; 
    align-items: flex-start; 
    justify-content: center; 
}
        
        .foto-wrapper {
            position: sticky;
            top: 20px;
            z-index: 10;
        }

        .foto-container { 
            width: 200px; height: 250px; background: #000; border: 1px solid #333; 
            position: relative; cursor: pointer; overflow: hidden; display: flex; 
            align-items: center; justify-content: center; transition: 0.5s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }
        .foto-container:hover { border-color: #fff; }
        .foto-container img { width: 100%; height: 100%; object-fit: cover; }
        .foto-placeholder { text-align: center; color: #444; font-size: 0.7em; letter-spacing: 2px; }

       .info-pessoais { 
    flex: 1; 
    display: grid; 
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); /* ‚Üê MUDEI DE 180px PARA 200px */
    gap: 20px; 
    max-width: 650px; 
}
        .field { display: flex; flex-direction: column; }
        label { font-size: 0.7em; margin-bottom: 6px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        
        input { 
    background: #000; 
    color: #913a3a; 
    border: 1px solid #222; 
    padding: 10px; 
    border-radius: 0; 
    font-family: 'Courier New', monospace;
    transition: 0.3s;
    font-size: 13px; 
}
        input:focus { border-color: #555; outline: none; background: #050505; }

        button { 
            cursor: pointer; background: linear-gradient(180deg, #333 0%, #111 100%); 
            color: #bbb; border: 1px solid #444; padding: 12px 18px; 
            text-transform: uppercase; font-size: 0.7em; letter-spacing: 2px; transition: 0.3s; 
        }
        button:hover { background: #fff; color: #000; border-color: #fff; box-shadow: 0 0 15px rgba(255,255,255,0.2); }

        .weapon-table, .pericias-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.8em; }
        .weapon-table th, .pericias-table th { background: #151515; color: #888; text-transform: uppercase; padding: 10px; border: 1px solid #222; font-weight: normal; letter-spacing: 1px; }
        .weapon-table td, .pericias-table td { border: 1px solid #222; padding: 5px; background: #0a0a0a; }
        .weapon-table input, .pericias-table input { width: 90%; border: none; background: transparent; padding: 5px; color: #eee; text-align: center; }

        .btn-remove-weapon { background: #300; color: #fff; border: none; padding: 2px 8px; cursor: pointer; transition: 0.3s; }
        .btn-remove-weapon:hover { background: #f00; }

        .grid-pericias { 
    min-height: 200px;  
    display: grid; 
    grid-template-columns: repeat(2, 1fr); 
    gap: 20px; 
}

        .dice-roller { background: #0a0a0a; border: 1px solid #222; padding: 25px; margin-bottom: 30px; text-align: center; }
        .dice-display { margin-top: 15px; font-family: 'Courier New', monospace; font-size: 1.3em; color: #fff; background: #000; padding: 15px; border: 1px solid #1a1a1a; }

        .grid-atributos { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; }
        .attr-card { background: #0f0f0f; padding: 20px; border: 1px solid #222; text-align: center; position: relative; }

/* Tooltip para atributos */
.attr-tooltip {
    display: none;
    position: absolute;
    bottom: 110%;
    left: 50%;
    transform: translateX(-50%);
    width: 280px;
    background: #050505;
    border: 1px solid #721717;
    padding: 12px;
    z-index: 999;
    font-size: 10px;
    color: #ccc;
    font-family: monospace;
    line-height: 1.5;
    box-shadow: 0 5px 15px rgba(0,0,0,0.8);
    pointer-events: none;
}

.attr-card:hover .attr-tooltip {
    display: block;
}

        .sub-vals { font-size: 0.7em; color: #555; margin-top: 12px; border-top: 1px solid #1a1a1a; padding-top: 8px; }
        
        .status-container-complex { display: flex; flex-direction: column; gap: 20px; margin-bottom: 30px; }
        .bar-wrapper { background: #050505; border: 1px solid #222; padding: 15px; position: relative; }
        .bar-info { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.8em; letter-spacing: 1px; }
        .progress-bg { background: #111; height: 12px; border: 1px solid #000; width: 100%; position: relative; }
        .progress-fill { height: 100%; transition: width 0.4s ease; }
        
        #fill-PV { background: linear-gradient(90deg, #600, #f00); box-shadow: 0 0 10px rgba(255,0,0,0.3); }
        #fill-SAN { background: linear-gradient(90deg, #004, #06f); box-shadow: 0 0 10px rgba(0,100,255,0.3); }
        #fill-MAG { background: linear-gradient(90deg, #303, #a0a); box-shadow: 0 0 10px rgba(160,0,160,0.3); }

        .bar-controls { display: flex; align-items: center; gap: 5px; margin-top: 10px; justify-content: center; }
        .btn-ctrl { padding: 2px 8px; font-size: 10px; min-width: 35px; }

        .status-derivados { display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-top: 20px; }
        .status-box { background: linear-gradient(145deg, #111, #050505); padding: 15px; border: 1px solid #2a2a2a; min-width: 110px; text-align: center; }
        .result-box { color: #fff; font-size: 1.5em; font-weight: 300; display: block; margin-top: 5px; }

        #result-overlay {
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%) scale(0);
            z-index: 10000; 
            text-align: center; 
            pointer-events: none;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            width: 100%;
        }
        #result-overlay.active { transform: translate(-50%, -50%) scale(1.8); }
        .res-title { font-size: 3rem; background: #fff; color: #000; padding: 5px 30px; border: 4px double #000; display: inline-block; }
        .res-detail { font-size: 1rem; color: #fff; background: #000; padding: 5px 15px; border: 1px solid #fff; margin-top: 10px; display: block; margin-left: auto; margin-right: auto; max-width: fit-content; }

        footer {
            margin-top: 50px;
            text-align: center;
            padding: 20px;
            border-top: 1px solid #222;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
            color: #444;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        footer b { color: #666; font-weight: normal; }

        .save-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 5000;
        }

        .investigadores-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 280px;
            max-height: 80vh;
            background: rgba(0,0,0,0.95);
            border: 2px solid #333;
            padding: 20px;
            z-index: 1000;
            overflow-y: auto;
            box-shadow: 0 0 40px rgba(0,0,0,1);
        }

        .investigador-item {
            background: #0a0a0a;
            border: 1px solid #222;
            padding: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .investigador-item:hover {
            border-color: #fff;
            background: #111;
        }

        .investigador-item button {
            padding: 5px 10px;
            font-size: 9px;
            background: #300;
        }

        .btn-add-pericia {
            background: #003300;
            border-color: #006600;
            color: #00ff00;
            margin-top: 10px;
            font-size: 0.6em;
            padding: 8px 15px;
        }

        .pericia-custom {
            background: #0a0a0a !important;
        }

        .pericia-custom td:first-child {
            color: #00ff00 !important;
        }

/* --- ESTILOS DOS REQUISITOS DE SENHA --- */

.req-container {
    margin-top: 10px;
    text-align: left;
    font-size: 10px;
    padding: 10px;
    background: #050505;
    border: 1px solid #222;
    border-radius: 4px;
    font-family: monospace;
}

.req-item {
    color: #550000; /* Vermelho escuro/apagado para o estado inicial */
    transition: all 0.3s ease;
    margin-bottom: 5px;
    display: flex;
    align-items: center;
}

/* Bolinha indicadora antes do texto */
.req-item::before {
    content: "‚úñ";
    margin-right: 8px;
    font-size: 8px;
}

/* Quando o requisito for cumprido */
.req-item.valid {
    color: #00ff00; /* Verde brilhante */
    text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
    transform: translateX(5px); /* Pequeno deslocamento para a direita */
}

.req-item.valid::before {
    content: "‚úî";
}


/* Estilo do nome da per√≠cia para indicar que tem informa√ß√£o */
.pericia-nome {
    color: #888;
    cursor: help;
    border-bottom: 1px dotted #444; /* Linha pontilhada sutil */
    display: inline-block;
    width: 100%;
    transition: color 0.3s;
    font-size: 15px;
}

.pericia-nome:hover {
    color: #b00; /* Fica vermelho escuro ao passar o mouse */
}

/* Customiza√ß√£o do Tooltip (opcional, dependendo do navegador) */
[title]:hover::after {
    content: attr(title);
    position: absolute;
    background: #111;
    color: #ccc;
    border: 1px solid #600;
    padding: 8px;
    font-size: 11px;
    z-index: 999;
    width: 200px;
    white-space: normal;
    box-shadow: 5px 5px 15px rgba(0,0,0,0.8);
    pointer-events: none; /* N√£o atrapalha o clique */
}


/* Efeito especial apenas para quando for N√≠vel de Cr√©dito */
span.pericia-nome[title*="padr√£o de vida"] {
    color: #ff0 !important;
    text-shadow: 0 0 5px rgba(255, 255, 0, 0.4);
}


/* Container que segura o texto e o bal√£o */
.tooltip-container {
    position: relative;
    display: inline-block;
    cursor: help;
}

/* O Bal√£o de Mensagem */
.tooltip-box {
    visibility: hidden;
    position: absolute;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    width: 220px;
    background-color: #000;
    color: #ff0;
    text-align: center;
    padding: 10px;
    z-index: 1000;
    font-size: 11px;
    opacity: 0;
    transition: opacity 0.3s;
    
    /* A m√°gica da borda radiante */
    border: 2px solid transparent;
    border-image: linear-gradient(0deg, #330, #ff0, #330) 1;
    animation: bordaGira 2s linear infinite;
    box-shadow: 0 0 15px rgba(255, 255, 0, 0.2);
}

/* Mostrar ao passar o mouse */
.tooltip-container:hover .tooltip-box {
    visibility: visible;
    opacity: 1;
}

/* Anima√ß√£o que faz a luz "correr" pela borda */
@keyframes bordaGira {
    0% {
        border-image-source: linear-gradient(0deg, #330, #ff0, #330);
    }
    25% {
        border-image-source: linear-gradient(90deg, #330, #ff0, #330);
    }
    50% {
        border-image-source: linear-gradient(180deg, #330, #ff0, #330);
    }
    75% {
        border-image-source: linear-gradient(270deg, #330, #ff0, #330);
    }
    100% {
        border-image-source: linear-gradient(360deg, #330, #ff0, #330);
    }
}

/* Estilo extra para o texto brilhar levemente */
.tooltip-box {
    text-shadow: 0 0 5px rgba(255, 255, 0, 0.5);
    font-family: 'Courier New', Courier, monospace;
}

/* Container que envolve o nome da per√≠cia e o bal√£o */
.tooltip-wrapper {
    position: relative;
    display: inline-block;
    width: 100%;
}

/* O Bal√£o de Mensagem que aparece ao passar o mouse */
.tooltip-box {
    visibility: hidden;
    position: absolute;
    bottom: 125%; /* Aparece acima do nome */
    left: 0;
    width: 220px;
    background-color: #000; /* Fundo preto total */
    padding: 10px;
    z-index: 1000;
    font-size: 11px;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
    text-align: center;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.9);
}

/* Faz o bal√£o aparecer no Hover */
.tooltip-wrapper:hover .tooltip-box {
    visibility: visible;
    opacity: 1;
}

/* A BORDA RADIANTE AMARELA (Exclusiva para N√≠vel de Cr√©dito) */
.borda-amarela-animada {
    color: #ff0 !important; /* Texto amarelo */
    border: 2px solid transparent;
    border-image: linear-gradient(0deg, #440, #ff0, #440) 1;
    animation: bordaGira 1.2s linear infinite; /* Velocidade r√°pida */
    box-shadow: 0 0 15px rgba(255, 255, 0, 0.3);
    text-shadow: 0 0 5px rgba(255, 255, 0, 0.5);
}

/* Borda padr√£o vermelha para as outras per√≠cias */
.borda-padrao {
    color: #ccc;
    border: 1px solid #600; /* Vermelho escuro para combinar com o tema */
}

/* Anima√ß√£o que faz a luz correr (Cima -> Direita -> Baixo -> Esquerda) */
@keyframes bordaGira {
    0%   { border-image-source: linear-gradient(0deg, #330, #ff0, #330); }
    25%  { border-image-source: linear-gradient(90deg, #330, #ff0, #330); }
    50%  { border-image-source: linear-gradient(180deg, #330, #ff0, #330); }
    75%  { border-image-source: linear-gradient(270deg, #330, #ff0, #330); }
    100% { border-image-source: linear-gradient(360deg, #330, #ff0, #330); }
}


/* === SISTEMA DE ABAS === */
.tabs-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 30px;
    border-bottom: 2px solid #222;
    padding-bottom: 0;
}

.tab-button {
    background: #0a0a0a;
    border: 1px solid #333;
    border-bottom: none;
    color: #666;
    padding: 12px 30px;
    cursor: pointer;
    transition: 0.3s;
    font-size: 11px;
    letter-spacing: 2px;
    position: relative;
    top: 2px;
}

.tab-button:hover {
    background: #111;
    color: #aaa;
}

.tab-button.active {
    background: #1a1a1a;
    color: #fff;
    border-color: #666;
    border-bottom: 2px solid #1a1a1a;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.antecedentes-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.antecedente-field {
    display: flex;
    flex-direction: column;
}

.antecedente-field label {
    font-size: 10px;
    color: #666;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.antecedente-field textarea {
    background: #000;
    border: 1px solid #222;
    color: #ccc;
    padding: 10px;
    font-family: 'Courier New', monospace;
    font-size: 12px;
    resize: vertical;
    min-height: 80px;
}

.antecedente-field textarea:focus {
    border-color: #555;
    outline: none;
}

.inventario-lista {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 15px;
}

.item-inventario {
    background: #0a0a0a;
    border: 1px solid #222;
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.item-inventario input {
    background: #000;
    border: 1px solid #333;
    color: #ccc;
    padding: 8px;
}

/* === CORES PARA PER√çCIAS === */
.pericia-color-marker {
    display: none; /* Come√ßa escondido */
    gap: 5px;
    margin-top: 5px;
    padding: 5px;
    background: #050505;
    border: 1px solid #222;
    align-items: center;
    flex-wrap: wrap;
}

.pericia-color-marker.visible {
    display: flex; /* Mostra quando tiver a classe 'visible' */
}

.color-cube {
    width: 14px;
    height: 14px;
    border: 1px solid #000;
    cursor: pointer;
    transition: 0.2s;
}

.color-cube:hover {
    transform: scale(1.3);
    box-shadow: 0 0 8px currentColor;
}

.color-cube.selected {
    box-shadow: 0 0 10px currentColor, inset 0 0 5px rgba(255,255,255,0.3);
    border-width: 2px;
    transform: scale(1.2);
}

.btn-toggle-cor {
    background: #0a0a0a;
    border: 1px solid #333;
    color: #666;
    padding: 3px 8px;
    font-size: 9px;
    cursor: pointer;
    transition: 0.2s;
}

.btn-toggle-cor:hover {
    background: #1a1a1a;
    color: #aaa;
    border-color: #555;
}

.btn-toggle-cor.active {
    background: #1a1a1a;
    color: #00ff00;
    border-color: #00ff00;
}

/* === CHECKBOXES DE STATUS === */
.status-checks {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    margin-top: 20px;
    padding: 20px;
    background: #0a0a0a;
    border: 1px solid #222;
}

.status-check-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    background: #050505;
    border: 1px solid #1a1a1a;
    cursor: pointer;
    transition: 0.3s;
}

.status-check-item:hover {
    border-color: #444;
}

.status-check-item input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
    accent-color: #8a0000;
}

.status-check-item label {
    font-size: 11px;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: pointer;
    margin: 0;
}

.status-check-item.checked {
    border-color: #8a0000;
    background: rgba(138, 0, 0, 0.1);
}

.status-check-item.checked label {
    color: #ff4444;
}


.status-vida-container {
    margin-top: 10px;
}

.box-vida {
    background: #050505;
    border: 1px solid #444;
    padding: 10px;
    text-align: center;
    cursor: help;
    transition: all 0.3s ease;
    position: relative;
}

/* Quando o mouse passa, a borda brilha conforme a classe ativa via JS */
.box-vida:hover {
    background: #0a0a0a;
}

.valor-vida {
    font-family: 'Courier New', Courier, monospace;
    font-weight: bold;
    font-size: 20px;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-top: 5px;
}

/* Estiliza√ß√£o din√¢mica para cada n√≠vel (ser√£o aplicadas via JS) */
.vida-pobretao { border-color: #333; color: #666; }
.vida-pobre { border-color: #840; color: #a50; }
.vida-medio { border-color: #060; color: #0a0; }
.vida-abastado { border-color: #ff0; color: #ff0; box-shadow: inset 0 0 10px rgba(255,255,0,0.1); }
.vida-rico { border-color: #f0f; color: #f0f; box-shadow: inset 0 0 10px rgba(255,0,255,0.1); }

.btn-reset-cor {
    background: #222;
    border: 1px solid #444;
    color: #666;
    font-size: 9px;
    padding: 2px 6px;
    cursor: pointer;
    margin-left: 4px;
    transition: all 0.2s;
    font-family: monospace;
}

.btn-reset-cor:hover {
    background: #400; /* Fica levemente vermelho ao passar o mouse */
    color: #ff4444;
    border-color: #800;
}

/* Ajuste opcional para manter os bot√µes alinhados na mesma linha */
.btn-toggle-cor {
    /* Garanta que o bot√£o COR tenha o display inline ou similar */
    padding: 2px 8px;
    font-size: 10px;
}


.user-account-bar {
    position: fixed;
    top: 365px; /* Ajuste para ficar logo abaixo do player */
    left: 20px;
    width: 230px; /* Alinhado com a largura do player */
    background: #0a0a0a; /* Fundo preto s√≥lido */
    border: 1px solid #333; /* Borda cinza chumbo */
    border-left: 3px solid #666; /* Detalhe lateral em cinza m√©dio (Noir) */
    padding: 8px 12px;
    z-index: 9998;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.9);
    animation: flyInPlayer 1.2s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

.user-account-content {
    display: flex;
    align-items: center;
    gap: 8px;
}

.user-status-light {
    width: 6px;
    height: 6px;
    background: #00ff00; /* Mant√©m o verde para indicar 'sistema ativo' */
    border-radius: 50%;
    box-shadow: 0 0 4px #00ff00;
}

.user-label {
    font-family: monospace;
    font-size: 8px;
    color: #444; /* Cinza escuro */
    letter-spacing: 1px;
}

.user-value {
    font-family: 'Courier New', monospace;
    font-size: 11px;
    color: #aaa; /* Cinza claro/met√°lico */
    font-weight: bold;
    text-transform: uppercase;
}

@keyframes flyInPlayer {
    0% { transform: translateX(120%); opacity: 0; }
    100% { transform: translateX(0); opacity: 1; }
}


#login-overlay {
    /* O quarto n√∫mero (0.8) √© a transpar√™ncia: 
       0.0 (totalmente invis√≠vel) at√© 1.0 (totalmente opaco) */
    background-color: rgba(0, 0, 0, 1) !important; 
    
    /* Opcional: Adiciona um desfoque no que est√° atr√°s */
    backdrop-filter: blur(5px); 
}

.tooltip-pericias {
    position: relative;
    cursor: help;
    color: #00ff00; /* Cor de destaque */
    border-bottom: 1px dashed #555;
}

.tooltip-text {
    visibility: hidden;
    width: 250px;
    background-color: #0a0a0a;
    color: #ccc;
    text-align: left;
    border: 1px solid #721717;
    padding: 10px;
    position: absolute;
    z-index: 100;
    bottom: 125%; /* Aparece acima do texto */
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 11px;
    line-height: 1.4;
    font-family: monospace;
    pointer-events: none;
    box-shadow: 0 0 15px #000;
}

.tooltip-pericias:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}


.tooltip-pericias {
    position: relative;
    cursor: help;
    color: #00ff00; /* Cor de destaque */
    border-bottom: 1px dashed #555;
}

.tooltip-text {
    visibility: hidden;
    width: 250px;
    background-color: #0a0a0a;
    color: #ccc;
    text-align: left;
    border: 1px solid #721717;
    padding: 10px;
    position: absolute;
    z-index: 100;
    bottom: 125%; /* Aparece acima do texto */
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 11px;
    line-height: 1.4;
    font-family: monospace;
    pointer-events: none;
    box-shadow: 0 0 15px #000;
}

.tooltip-pericias:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}


    </style>
</head>
<body>


<!-- SOM DE HOVER -->
<audio id="hover-sound" preload="auto">
    <source src="undertale-move-selection-sound-effect.mp3" type="audio/mpeg">
</audio>

<div id="login-overlay">
    <div class="login-card">
        <img src="https://i.pinimg.com/736x/71/8a/d9/718ad93c88c10dea945392bfa43ed220.jpg" style="width: 80px; border-radius: 50%; margin-bottom: 20px; filter: grayscale(1);">
        
        <div class="login-tabs">
            <button class="tab-btn active" id="btn-login-tab" onclick="switchTab('login')">ENTRAR</button>
            <button class="tab-btn" id="btn-signup-tab" onclick="switchTab('signup')">CRIAR CONTA</button>
        </div>

        <div id="login-form">
            <div class="input-group">
                <label>NOME DE INVESTIGADOR</label>
                <input type="text" id="loginUser" style="width: 100%;">
            </div>
            <div class="input-group">
                <label>SENHA DE ACESSO</label>
                <input type="password" id="loginPass" style="width: 100%;">
            </div>
            <button onclick="realizarLogin()" class="btn-login">ABRIR ARQUIVO</button>
        </div>

        <div id="signup-form" style="display: none;">
            <div class="input-group">
                <label>NOVO NOME DE INVESTIGADOR</label>
                <input type="text" id="signupUser" style="width: 100%;">
            </div>
            <div class="input-group">
                <label>CRIAR SENHA</label>
                <input type="password" id="signupPass" style="width: 100%;">
                <div id="password-requirements" class="req-container">
                    <div id="req-length" class="req-item">‚Ä¢ M√≠nimo 6 caracteres</div>
                    <div id="req-upper" class="req-item">‚Ä¢ 1 Letra mai√∫scula</div>
                    <div id="req-lower" class="req-item">‚Ä¢ 1 Letra min√∫scula</div>
                    <div id="req-number" class="req-item">‚Ä¢ 1 N√∫mero</div>
                    <div id="req-special" class="req-item">‚Ä¢ 1 Caractere especial</div>
                </div>
            </div>
            <button onclick="realizarCadastro()" style="width: 100%; margin-top: 10px;">REGISTRAR INVESTIGADOR</button>
        </div>
        
        <p id="login-msg" style="font-size: 10px; color: #913a3a; margin-top: 15px;"></p>

        <footer class="login-footer">
            <div class="footer-left">
                <img src="https://i.pinimg.com/736x/7e/f0/d3/7ef0d35a8fd17512ae318aace2dc52c9.jpg" class="footer-avatar">
                <div class="footer-info">
                    <b>Anderson - Volkomenn</b> ‚Äî ¬© 2026
                </div>
            </div>
        </p>
            <div class="footer">
                <a href="https://www.tiktok.com/@volkomennnnn" target="_blank" class="social-link">
                    <img src="https://cdn.discordapp.com/emojis/1380004958329376841.webp?size=40" class="social-icon"> TikTok
                </a>
                <a href="https://www.twitch.tv/voikomenn" target="_blank" class="social-link">
                    <img src="https://cdn.discordapp.com/emojis/846873277778624522.webp?size=40" class="social-icon"> Twitch
                </a>
                <a href="https://x.com/l_andrssn" target="_blank" class="social-link">
                    <img src="https://cdn.discordapp.com/emojis/1157693022801235978.webp?size=40" class="social-icon"> Twitter
                </a>
                <a href="https://discordapp.com/users/943254541346930768" target="_blank" class="social-link">
                    <img src="https://cdn.discordapp.com/emojis/1107191783919718400.webp?size=40" class="social-icon"> Discord
                </a>
            </div>
        </footer>
    </div>
</div>




<div id="bg-particles"></div>

<div id="menu-fichas" class="investigadores-panel">
    <button class="btn-janelinha-fichas" onclick="minimizarFichas()">üóó</button>

    <div class="panel-content" id="fichasContent">
        <div style="text-align: center; margin-bottom: 30px;">
            <img src="https://i.pinimg.com/736x/71/8a/d9/718ad93c88c10dea945392bfa43ed220.jpg" style="width: 60px; border-radius: 50%; filter: grayscale(1); margin-bottom: 10px; border: 1px solid #333;">
            <h3 style="font-size: 1em; letter-spacing: 4px; border: none; margin: 0;">ARQUIVOS CONFIDENCIAIS</h3>
            <p style="font-size: 9px; color: #555; letter-spacing: 2px;">SELECIONE UM INVESTIGADOR ATIVO</p>
        </div>

        <div id="investigadores-list" style="flex-grow: 1; overflow-y: auto; padding-right: 5px;">
        </div>

        <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #222;">
            <button onclick="criarNovoInvestigador()" style="width: 100%; margin-bottom: 12px; background: #0f0f0f; color: #666; font-weight: bold;">
                + REGISTRAR NOVO INVESTIGADOR
            </button>
            <button onclick="location.reload()" style="width: 100%; font-size: 9px; background: #1a1a1a; color: #666;">
                DESCONECTAR INVESTIGADOR
            </button>
        </div>
    </div>
</div>

<div class="save-controls">
    <button onclick="salvarLocal()" style="background: #002200; border-color: #004400; color: #00ff00;">SALVAR INVESTIGADOR</button>
    <button onclick="resetarFicha()" style="background: #332200; border-color: #664400; color: #ffaa00;">RESETAR FICHA</button>
    <button onclick="fazerLogout()" style="background: #330000; border-color: #550000; color: #ff0000;">LOGOUT</button>
    <div style="margin-top: 20px; display: flex; gap: 10px; padding: 10px; border-top: 1px solid #222;"><button onclick="exportarFichaJSON()" style="flex: 1; background: #1a1a1a; color: #888; border-color: #333;">üíæ EXPORTAR FICHA (.json)</button>
    <button onclick="document.getElementById('fileInputFicha').click()" style="flex: 1; background: #1a1a1a; color: #888; border-color: #333;">üìÇ IMPORTAR FICHA (.json)</button><input type="file" id="fileInputFicha" style="display: none;" accept=".json" onchange="importarFichaJSON(event)">
</div>
</div>
</div>

<div class="music-player-container" id="playerMusica">
    <button class="btn-janelinha" onclick="minimizarPlayer()">üóó</button>
    <div class="player-content">
        <img src="https://c.tenor.com/2qFbEpeTPkMAAAAC/tenor.gif" class="gif-musica" alt="Musica">
        <div style="font-size: 0.9em; color: #fff; margin-bottom: 15px; font-family: monospace; letter-spacing: 1px;">HIP SHOP</div>
        
        <audio id="bgMusic" loop>
            <source src="musicaficha.mp3">
        </audio>

        <div class="bar-controls">
            <button class="btn-ctrl" onclick="document.getElementById('bgMusic').play()">‚ñ∂ PLAY</button>
            <button class="btn-ctrl" onclick="document.getElementById('bgMusic').pause()">‚Ö° PAUSE</button>
        </div>
        
        <div style="margin-top: 20px; padding: 0 10px;">
            <input type="range" id="volSlider" min="0" max="1" step="0.01" value="0.1" oninput="document.getElementById('bgMusic').volume = this.value" style="width: 100%; cursor: pointer; filter: grayscale(1);">
            <label style="font-size: 10px; color: #666; display: block; margin-top: 5px;">VOLUME MASTER</label>
        </div>
    </div>
</div>

<div id="user-float-panel" class="user-account-bar">
    <div class="user-account-content">
        <div class="user-status-light"></div>
        <span class="user-label">CONTA REGISTRADA:</span>
        <span id="display-username" class="user-value">CARREGANDO...</span>
    </div>
</div>

<div id="result-overlay">
    <p id="overlay-title" class="res-title"></p>
    <p id="overlay-detail" class="res-detail"></p>
</div>

<div class="container main-content" id="ficha-editor">

<div id="player-musica" class="main-content">

<div style="margin-top: 15px; display: flex; flex-direction: column; gap: 8px;">
    <button onclick="abrirAjuda()" style="width: 100%; padding: 10px; font-size: 16px; background: #1a1a1a; color: #fff; border: 1px solid #333; cursor: pointer; font-family: monospace;">
        Como usar?
    </button>
    

<div style="margin-top: 15px;">
    <button onclick="window.abrirPainelFundo()" style="width: 100%; padding: 12px; background: #0a0a0a; color: #888; border: 1px solid #721717; cursor: pointer; font-family: monospace; font-size: 11px; letter-spacing: 1px;">
        Ajustar plano de fundo
    </button>
</div>

<div id="painelFundo" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.9); z-index: 9999999; backdrop-filter: blur(5px);">
    <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #0d0d0d; border: 1px solid #721717; padding: 30px; width: 320px; box-shadow: 0 0 50px #000; text-align: center;">
        
        <h3 style="color: #721717; font-family: monospace; margin-bottom: 25px; border-bottom: 1px solid #222; padding-bottom: 10px;">AMBIENTE DO AGENTE</h3>
        
        <button onclick="document.getElementById('inputArquivoFundo').click()" style="width: 100%; padding: 12px; background: #111; color: #aaa; border: 1px dashed #444; cursor: pointer; font-family: monospace; margin-bottom: 20px;">
            üìÅ CARREGAR M√çDIA LOCAL
        </button>
        <input type="file" id="inputArquivoFundo" accept="image/*,video/*" style="display: none;" onchange="window.processarArquivoFundo(this)">

        <div style="margin-bottom: 20px; text-align: left;">
            <label style="color: #666; font-size: 10px; font-family: monospace;">TRANSPAR√äNCIA DA FICHA</label>
            <input type="range" id="opacidadeFicha" min="0" max="1" step="0.05" value="0.9" oninput="window.ajustarOpacidadeFicha(this.value)" style="width: 100%; accent-color: #721717;">
        </div>

        <div style="margin-bottom: 30px; text-align: left;">
            <label style="color: #666; font-size: 10px; font-family: monospace;">BRILHO DO AMBIENTE</label>
            <input type="range" id="opacidadeFundoImg" min="0" max="1" step="0.05" value="1" oninput="window.ajustarOpacidadeFundo(this.value)" style="width: 100%; accent-color: #721717;">
        </div>

<div style="margin-bottom: 30px; text-align: left;">
    <label style="color: #666; font-size: 10px; font-family: monospace; display: block; margin-bottom: 10px;">POSI√á√ÉO DA IMAGEM</label>
    
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
        <div>
            <label style="color: #444; font-size: 9px;">HORIZONTAL (%)</label>
            <input type="range" id="posicaoX" min="0" max="100" value="50" oninput="window.ajustarPosicaoFundo()" style="width: 100%; accent-color: #721717;">
            <div id="valorX" style="color: #721717; font-size: 10px; text-align: center; margin-top: 2px;">50%</div>
        </div>
        <div>
            <label style="color: #444; font-size: 9px;">VERTICAL (%)</label>
            <input type="range" id="posicaoY" min="0" max="100" value="50" oninput="window.ajustarPosicaoFundo()" style="width: 100%; accent-color: #721717;">
            <div id="valorY" style="color: #721717; font-size: 10px; text-align: center; margin-top: 2px;">50%</div>
        </div>
    </div>
    
    <button onclick="window.centralizarFundo()" style="width: 100%; padding: 8px; background: #0a0a0a; color: #666; border: 1px solid #333; cursor: pointer; font-family: monospace; font-size: 9px;">
        CENTRALIZAR IMAGEM
    </button>
</div>

<div style="margin-bottom: 20px; text-align: left;">
    <label style="color: #666; font-size: 10px; font-family: monospace; display: block; margin-bottom: 5px;">TAMANHO DA IMAGEM (ZOOM)</label>
    <input type="range" id="zoomFundo" min="50" max="300" value="100" oninput="window.ajustarZoomFundo(this.value)" style="width: 100%; accent-color: #721717;">
    <div id="valorZoom" style="color: #721717; font-size: 10px; text-align: center; margin-top: 2px;">100%</div>
</div>


        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
    <button onclick="window.removerFundo()" style="flex: 1; padding: 10px; background: #0a0a0a; color: #666; border: 1px solid #333; cursor: pointer; font-family: monospace; font-size: 9px;">
        REMOVER FUNDO
    </button>

    <button onclick="window.redefinirTudo()" style="flex: 1; padding: 10px; background: #0a0a0a; color: #721717; border: 1px solid #721717; cursor: pointer; font-family: monospace; font-size: 9px;">
        REDEFINIR FUNDO
    </button>
</div>
        
        <button onclick="window.fecharPainelFundo()" style="width: 100%; padding: 12px; background: #1a1a1a; color: #721717; border: 1px solid #721717; cursor: pointer; font-family: monospace; font-weight: bold;">SALVAR E VOLTAR</button>
    </div>
</div>

<div id="overlay-escurecedor" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: -5; pointer-events: none; opacity: 0;"></div>


<body>
    <div id="ajuda-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="color:#5c2020; text-align:left; margin-top:0;">MANUAL DE OPERA√á√ïES</h3>
            <div class="modal-text">
                <p>1. Clique em "Registrar Novo Investigador" no menu principal.</p>
                <p>2. Preencha as informa√ß√µes e atributos do investigador manualmente ou clique no bot√£o de "auto-gerar".</p>
                <p>3. Role at√© o fim e clique em "Salvar Investigador".</p>
                <p>4. O sistema salva seu investigador atual antes de criar um novo e ao carregar a p√°gina voc√™ pode carregar um personagem j√° feito.</p>
                <p>5. JSON: Voc√™ pode exportar uma ficha e import√°-la. Essa fun√ß√£o permite que voc√™ consiga usar a mesma ficha em outro dispositivo sem ter que preench√™-la novamente.</p>
            </div>
            <button class="btn-close-modal" onclick="fecharAjuda()">ENTENDIDO</button>
        </div>
    </div>

    





    <img src="https://i.pinimg.com/736x/71/8a/d9/718ad93c88c10dea945392bfa43ed220.jpg" alt="Logo CoC" class="logo-projeto">
    <h1>Investigador Call of Cthulhu</h1>
    

<div class="section" style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    <div class="header-ficha-compacta" style="display: grid; grid-template-columns: 200px 1fr 320px; gap: 25px; align-items: start;">
        
        <div class="foto-wrapper" style="display: flex; flex-direction: column; align-items: center;">
            <div class="foto-container" onclick="document.getElementById('fileInput').click()" 
                 style="width: 180px; height: 230px; border: 2px solid #333; background: #050505; position: relative; cursor: pointer; display: flex; align-items: center; justify-content: center; overflow: hidden;">
                <div id="placeholderTxt" style="font-size: 10px; color: #444; text-align: center; text-transform: uppercase; letter-spacing: 1px;">
                    REGISTRO VISUAL<br>CLIQUE PARA INSERIR
                </div>
                <img id="charPhoto" src="" style="display:none; width: 100%; height: 100%; object-fit: cover;">
                <input type="file" id="fileInput" hidden accept="image/*" onchange="carregarFoto(event)">
            </div>
            <div style="margin-top: 10px; display: flex; gap: 5px; width: 180px;">
                <button onclick="removerFoto()" style="flex: 1; padding: 5px; font-size: 9px; background: #300; color: #fff; border: 1px solid #500; cursor: pointer;">REMOVER</button>
                <button id="btnDesfazer" onclick="desfazerFoto()" style="flex: 1; padding: 5px; font-size: 9px; background: #222; color: #666; border: 1px solid #333; opacity: 0.5;" disabled>VOLTAR</button>
            </div>
        </div>

        <div class="info-pessoais" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="field" style="grid-column: span 2;">
                <label style="color: #666; font-size: 10px; text-transform: uppercase;">Nome do Investigador</label>
                <input type="text" data-key="nome" style="width: 100%; background: #0a0a0a; border: 1px solid #333; color: #eee; padding: 8px;">
            </div>
            <div class="field">
                <label style="color: #666; font-size: 10px; text-transform: uppercase;">Jogador(a)</label>
                <input type="text" data-key="jogador" style="width: 100%; background: #0a0a0a; border: 1px solid #333; color: #eee; padding: 8px;">
            </div>
<div class="field" style="position: relative; overflow: visible;">
    <label style="color: #666; font-size: 10px; text-transform: uppercase;">Idade</label>
    <div class="idade-wrapper" style="position: relative;">
        <input type="number" id="idade" 
               onchange="aplicarRegrasIdade()" 
               onmouseenter="mostrarTooltipIdade()" 
               onmouseleave="esconderTooltipIdade()"
               data-key="idade" 
               style="width: 100%; background: #0a0a0a; border: 1px solid #333; color: #eee; padding: 8px;">
        
        <div id="tooltip-idade" style="display: none; position: absolute; top: 110%; left: 0; z-index: 999; width: 250px; background: #050505; border: 1px solid #721717; padding: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.8); pointer-events: none;">
            <div id="tooltip-idade-conteudo" style="color: #ccc; font-size: 11px; font-family: monospace; line-height: 1.4;">
                Aguardando idade...
            </div>
        </div>
    </div>
</div>
            <div class="field">
                <label style="color: #666; font-size: 10px; text-transform: uppercase;">G√™nero</label>
                <input type="text" data-key="genero" style="width: 100%; background: #0a0a0a; border: 1px solid #333; color: #eee; padding: 8px;">
            </div>
            <div class="field">
                <label style="color: #666; font-size: 10px; text-transform: uppercase;">Local de Nasc.</label>
                <input type="text" data-key="nasc" style="width: 100%; background: #0a0a0a; border: 1px solid #333; color: #eee; padding: 8px;">
            </div>
            <div class="field" style="grid-column: span 2;">
                <label style="color: #666; font-size: 10px; text-transform: uppercase;">Resid√™ncia</label>
                <input type="text" data-key="residencia" style="width: 100%; background: #0a0a0a; border: 1px solid #333; color: #eee; padding: 8px;">
            </div>
        </div>

        <div class="bloco-ocupacao" style="background: #080808; border: 1px solid #222; padding: 15px; border-radius: 4px;">
            <label style="color: #721717; font-size: 11px; font-weight: bold; display: block; margin-bottom: 10px; letter-spacing: 1px;">SISTEMA DE OCUPA√á√ÉO</label>
            
            <div style="display: flex; gap: 5px; margin-bottom: 15px;">
                <input type="text" id="input-ocupacao" readonly placeholder="Selecione!" data-key="ocupacao"
                       style="background: #000; border: 1px solid #444; color: #721717; padding: 8px; flex: 1; font-family: monospace; font-size: 12px;">
                <button type="button" onclick="abrirModalOcupacoes()" 
                        style="background: #721717; color: #fff; border: none; padding: 0 10px; cursor: pointer; font-size: 10px; font-weight: bold;">
                    ALTERAR
                </button>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                <div style="background: #000; padding: 8px; border: 1px solid #222; text-align: center;">
                    <label style="color: #555; font-size: 8px; display: block; margin-bottom: 4px;">CR√âDITO</label>
                    <div id="credito-permitido" style="color: #ffaa00; font-size: 13px; font-weight: bold;">-</div>
                </div>
                <div style="background: #000; padding: 8px; border: 1px solid #222; text-align: center;">
                    <label style="color: #555; font-size: 8px; display: block; margin-bottom: 4px;">INTERP.</label>
                    <div id="interpessoais-qtd" style="color: #00ff00; font-size: 13px; font-weight: bold;">-</div>
                </div>
            </div>

            <div style="background: #000; border: 1px dashed #444; padding: 10px; text-align: center;">
                <span style="color: #666; font-size: 9px; text-transform: uppercase;">Pontos Ocupacionais</span>
                <div id="display-pontos-ocupacao" style="color: #721717; font-size: 24px; font-weight: bold; font-family: 'Courier New';">0</div>
                <small id="formula-usada" style="color: #333; font-size: 8px; display: block; margin-top: 2px;"></small>
            </div>
        </div>
    </div>
</div>

<div id="modal-ocupacoes" class="modal-overlay" style="display:none;">
    <div class="modal-box">
        <div class="modal-header">
            <span>SELECIONAR OCUPA√á√ÉO</span>
            <button onclick="fecharModalOcupacoes()">X</button>
        </div>
        <div id="lista-ocupacoes-grid" class="ocupacoes-grid"></div>
    </div>
</div>

    <div class="dice-roller">
        <label style="color: #666; letter-spacing: 2px;">MECANISMO DE PROBABILIDADE</label><br><br>
        <input type="text" id="diceInput" placeholder="Ex: 3d6">
        <button onclick="rollCustomDice()">EXECUTAR ROLAGEM</button>
        <div id="diceDisplay" class="dice-display">AGUARDANDO...</div>
    </div>

    <div class="section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 style="margin:0; border:none;">Atributos Base</h2>
            <button onclick="gerarTodosAtributos()" style="font-size: 0.6em; padding: 5px 10px;">AUTO-GERAR</button>

<!-- PAINEL DE RESULTADO DE ATRIBUTOS -->
<div id="painel-resultado-atributos" style="max-height: 0; overflow: hidden; transition: max-height 0.4s ease, padding 0.4s ease; padding: 0; margin-top: 0;">
    <div style="background: #050505; border: 1px solid #721717; padding: 20px; text-align: center;">
        <div style="color: #721717; font-size: 11px; margin-bottom: 10px; font-family: monospace;">RESULTADO DA ROLAGEM</div>
        <div id="texto-resultado-atributo" style="color: #fff; font-size: 16px; font-family: 'Courier New', monospace;"></div>
    </div>
</div>

        </div>
        <div id="attrContainer" class="grid-atributos"></div>
    </div>


    <div class="section">
    <h3>Sinais Vitais e Ps√≠quicos</h3>
    <div class="status-container-complex">
        <div class="bar-wrapper">
            <div class="bar-info">
                <span>PONTOS DE VIDA (PV)</span>
                <span id="txt-PV">0 / 0</span>
            </div>
            <div class="progress-bg"><div id="fill-PV" class="progress-fill" style="width: 100%"></div></div>
            <div style="display: flex; gap: 10px; margin-top: 10px; align-items: center; justify-content: center;">
                <div style="border: 1px solid #333; padding: 8px; background: #0a0a0a;">
                    <label style="font-size: 9px; margin-bottom: 5px; display: block;">ATUAL</label>
                    <div class="bar-controls">
                        <button class="btn-ctrl" onclick="modStatus('PV', -5)">&lt;&lt;</button>
                        <button class="btn-ctrl" onclick="modStatus('PV', -1)">&lt;</button>
                        <button class="btn-ctrl" onclick="modStatus('PV', 1)">&gt;</button>
                        <button class="btn-ctrl" onclick="modStatus('PV', 5)">&gt;&gt;</button>
                    </div>
                </div>
                <div style="border: 1px solid #333; padding: 8px; background: #0a0a0a;">
                    <label style="font-size: 9px; margin-bottom: 5px; display: block;">M√ÅXIMO</label>
                    <div class="bar-controls">
                        <button class="btn-ctrl" onclick="modStatusMax('PV', -5)">&lt;&lt;</button>
                        <button class="btn-ctrl" onclick="modStatusMax('PV', -1)">&lt;</button>
                        <button class="btn-ctrl" onclick="modStatusMax('PV', 1)">&gt;</button>
                        <button class="btn-ctrl" onclick="modStatusMax('PV', 5)">&gt;&gt;</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="bar-wrapper">
            <div class="bar-info">
                <span>SANIDADE (SAN)</span>
                <span id="txt-SAN">0 / 0</span>
            </div>
            <div class="progress-bg"><div id="fill-SAN" class="progress-fill" style="width: 100%"></div></div>
            <div style="display: flex; gap: 10px; margin-top: 10px; align-items: center; justify-content: center;">
                <div style="border: 1px solid #333; padding: 8px; background: #0a0a0a;">
                    <label style="font-size: 9px; margin-bottom: 5px; display: block;">ATUAL</label>
                    <div class="bar-controls">
                        <button class="btn-ctrl" onclick="modStatus('SAN', -5)">&lt;&lt;</button>
                        <button class="btn-ctrl" onclick="modStatus('SAN', -1)">&lt;</button>
                        <button class="btn-ctrl" onclick="modStatus('SAN', 1)">&gt;</button>
                        <button class="btn-ctrl" onclick="modStatus('SAN', 5)">&gt;&gt;</button>
                    </div>
                </div>
                <div style="border: 1px solid #333; padding: 8px; background: #0a0a0a;">
                    <label style="font-size: 9px; margin-bottom: 5px; display: block;">M√ÅXIMO</label>
                    <div class="bar-controls">
                        <button class="btn-ctrl" onclick="modStatusMax('SAN', -5)">&lt;&lt;</button>
                        <button class="btn-ctrl" onclick="modStatusMax('SAN', -1)">&lt;</button>
                        <button class="btn-ctrl" onclick="modStatusMax('SAN', 1)">&gt;</button>
                        <button class="btn-ctrl" onclick="modStatusMax('SAN', 5)">&gt;&gt;</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="bar-wrapper">
            <div class="bar-info">
                <span>PONTOS DE MAGIA (PM)</span>
                <span id="txt-MAG">0 / 0</span>
            </div>
            <div class="progress-bg"><div id="fill-MAG" class="progress-fill" style="width: 100%"></div></div>
            <div style="display: flex; gap: 10px; margin-top: 10px; align-items: center; justify-content: center;">
                <div style="border: 1px solid #333; padding: 8px; background: #0a0a0a;">
                    <label style="font-size: 9px; margin-bottom: 5px; display: block;">ATUAL</label>
                    <div class="bar-controls">
                        <button class="btn-ctrl" onclick="modStatus('MAG', -5)">&lt;&lt;</button>
                        <button class="btn-ctrl" onclick="modStatus('MAG', -1)">&lt;</button>
                        <button class="btn-ctrl" onclick="modStatus('MAG', 1)">&gt;</button>
                        <button class="btn-ctrl" onclick="modStatus('MAG', 5)">&gt;&gt;</button>
                    </div>
                </div>
                <div style="border: 1px solid #333; padding: 8px; background: #0a0a0a;">
                    <label style="font-size: 9px; margin-bottom: 5px; display: block;">M√ÅXIMO</label>
                    <div class="bar-controls">
                        <button class="btn-ctrl" onclick="modStatusMax('MAG', -5)">&lt;&lt;</button>
                        <button class="btn-ctrl" onclick="modStatusMax('MAG', -1)">&lt;</button>
                        <button class="btn-ctrl" onclick="modStatusMax('MAG', 1)">&gt;</button>
                        <button class="btn-ctrl" onclick="modStatusMax('MAG', 5)">&gt;&gt;</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="status-derivados">
        <div class="status-box">SORTE<br><span id="valSORTE" class="result-box">-</span> <button style="padding:2px 5px; font-size: 9px;" onclick="rolarSorte()">üé≤</button></div>
        <div class="status-box">MOV<br><span id="valMOV" class="result-box">-</span></div>
        <div class="status-box">DX<br><span id="valDX" class="result-box">-</span></div>
        <div class="status-box">CORPO<br><span id="valCorpo" class="result-box">-</span></div>
        <div class="status-box">ESQUIVA<br><span id="valESQUIVA" class="result-box">-</span></div>
    </div>
</div>

<!-- SISTEMA DE ABAS -->
<div class="section">
    <div class="tabs-container">
        <button class="tab-button active" onclick="trocarAba('pericias')">PER√çCIAS</button>
        <button class="tab-button" onclick="trocarAba('antecedentes')">ANTECEDENTES</button>
        <button class="tab-button" onclick="trocarAba('inventario')">INVENT√ÅRIO</button>
    </div>

    <!-- ABA PER√çCIAS (conte√∫do atual) -->
    <div id="tab-pericias" class="tab-content active">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin:0; border:none;">Per√≠cias & Compet√™ncias</h3>

<!-- PAINEL DE RESULTADO DE PER√çCIAS -->
<div id="painel-resultado-pericias" style="max-height: 0; overflow: hidden; transition: max-height 0.4s ease, padding 0.4s ease; padding: 0; margin-bottom: 0;">
    <div style="background: #050505; border: 1px solid #721717; padding: 20px; text-align: center;">
        <div style="color: #721717; font-size: 11px; margin-bottom: 10px; font-family: monospace;">RESULTADO DA PER√çCIA</div>
        <div id="texto-resultado-pericias" style="color: #fff; font-size: 16px; font-family: 'Courier New', monospace;"></div>
    </div>
</div>


            <button onclick="adicionarPericiaCustom()" class="btn-add-pericia">+ ADICIONAR PER√çCIA</button>
        </div>

<!-- PAINEL DE RESULTADO DE PER√çCIAS -->
<div id="painel-resultado-pericias" style="max-height: 0; overflow: hidden; transition: max-height 0.4s ease, padding 0.4s ease, margin 0.4s ease; padding: 0; margin-bottom: 0;">
    <div style="background: #050505; border: 1px solid #721717; padding: 20px; text-align: center;">
        <div style="color: #721717; font-size: 11px; margin-bottom: 10px; font-family: monospace; letter-spacing: 2px;">‚ïë RESULTADO DA PER√çCIA ‚ïë</div>
        <div id="texto-resultado-pericias" style="color: #fff; font-size: 14px; font-family: 'Courier New', monospace; line-height: 1.6;"></div>
    </div>
</div>

        <div class="grid-pericias" id="periciasContainer"></div>
    </div>

<div class="status-vida-container">
    <div id="box-padrao-vida" class="box-vida" title="Seu padr√£o de vida atual baseado no seu N√≠vel de Cr√©dito.">
        <label class="label-superior">PADR√ÉO DE VIDA</label>
        <div id="txt-padrao-vida" class="valor-vida">N√ÉO DEFINIDO</div>
    </div>
</div>


    <!-- ABA ANTECEDENTES -->
    <div id="tab-antecedentes" class="tab-content">
        <h3 style="margin:0 0 20px 0; border:none;">Hist√≥rico do Investigador</h3>
        <div class="antecedentes-grid">
            <div class="antecedente-field">
                <label>Descri√ß√£o Pessoal</label>
                <textarea data-antecedente="descricao" placeholder="Apar√™ncia, personalidade, estilo..."></textarea>
            </div>
            <div class="antecedente-field">
                <label>Ideologia/Cren√ßas</label>
                <textarea data-antecedente="ideologia" placeholder="Cren√ßas centrais, valores morais..."></textarea>
            </div>
            <div class="antecedente-field">
                <label>Pessoas Significativas</label>
                <textarea data-antecedente="pessoas" placeholder="Familiares, amigos, mentores importantes..."></textarea>
            </div>
            <div class="antecedente-field">
                <label>Locais Importantes</label>
                <textarea data-antecedente="locais" placeholder="Lugares marcantes da sua hist√≥ria..."></textarea>
            </div>
            <div class="antecedente-field">
                <label>Pertences Queridos</label>
                <textarea data-antecedente="pertences" placeholder="Objetos com valor sentimental..."></textarea>
            </div>
            <div class="antecedente-field">
                <label>Caracter√≠sticas</label>
                <textarea data-antecedente="caracteristicas" placeholder="Tra√ßos marcantes de personalidade..."></textarea>
            </div>
            <div class="antecedente-field">
                <label>Ferimentos & Cicatrizes</label>
                <textarea data-antecedente="ferimentos" placeholder="Marcas f√≠sicas do passado..."></textarea>
            </div>
            <div class="antecedente-field">
                <label>Fobias & Manias</label>
                <textarea data-antecedente="fobias" placeholder="Medos, obsess√µes, comportamentos..."></textarea>
            </div>
            <div class="antecedente-field">
                <label>Tomos Arcanos, Feiti√ßos & Artefatos</label>
                <textarea data-antecedente="tomos" placeholder="Conhecimentos e objetos m√≠sticos..."></textarea>
            </div>
            <div class="antecedente-field">
                <label>Encontros com Entidades Estranhas</label>
                <textarea data-antecedente="entidades" placeholder="Criaturas, horrores testemunhados..."></textarea>
            </div>
        </div>
    </div>

    <!-- ABA INVENT√ÅRIO -->
    <div id="tab-inventario" class="tab-content">
        <h3 style="margin:0 0 20px 0; border:none;">Equipamentos & Pertences</h3>
        <div class="inventario-lista" id="inventarioContainer"></div>
        <button onclick="adicionarItemInventario()" style="margin-top: 20px; font-size: 0.7em;">+ ADICIONAR ITEM</button>
    </div>
</div>

<!-- CHECKBOXES DE STATUS F√çSICO/MENTAL -->
<div class="section">
    <h3>Condi√ß√µes Especiais</h3>
    <div class="status-checks">
        <div class="status-check-item" onclick="toggleStatusCheck(this, 'morrendo')">
            <input type="checkbox" id="check-morrendo">
            <label for="check-morrendo">Morrendo</label>
        </div>
        <div class="status-check-item" onclick="toggleStatusCheck(this, 'inconsciente')">
            <input type="checkbox" id="check-inconsciente">
            <label for="check-inconsciente">Inconsciente</label>
        </div>
        <div class="status-check-item" onclick="toggleStatusCheck(this, 'lesao-grave')">
            <input type="checkbox" id="check-lesao-grave">
            <label for="check-lesao-grave">Les√£o Grave</label>
        </div>
        <div class="status-check-item" onclick="toggleStatusCheck(this, 'insano')">
            <input type="checkbox" id="check-insano">
            <label for="check-insano">Insano</label>
        </div>
        <div class="status-check-item" onclick="toggleStatusCheck(this, 'temporario')">
            <input type="checkbox" id="check-temporario">
            <label for="check-temporario">Insanidade Tempor√°ria</label>
        </div>
        <div class="status-check-item" onclick="toggleStatusCheck(this, 'indefinido')">
            <input type="checkbox" id="check-indefinido">
            <label for="check-indefinido">Insanidade Indefinida</label>
        </div>
    </div>
</div>


    <small id="formula-usada" style="font-size: 9px; color: #444; text-transform: uppercase;"></small>
</div>

    <div class="section">
        <h3>Arsenal</h3>
        <table class="weapon-table">
            <thead>
                <tr>
                    <th style="width: 25%;">Arma</th>
                    <th>Reg.</th><th>S√≥l.</th><th>Ext.</th><th>Dano</th><th>Alc.</th><th>Atqs</th><th>Mun.</th><th>Def.</th><th></th>
                </tr>
            </thead>
            <tbody id="weaponBody"></tbody>
        </table>
        <button onclick="addWeaponRow()" style="margin-top: 15px; font-size: 0.6em;">+ Adicionar Arma</button>
    </div>

<footer class="main-footer">
    <div class="footer-left">
        <img src="https://i.pinimg.com/736x/7e/f0/d3/7ef0d35a8fd17512ae318aace2dc52c9.jpg" class="footer-avatar">
        <div class="footer-info">
            Direitos reservados: <b>Anderson - Volkomenn</b> ‚Äî ¬© 2026
        </div>
    </div>

    <div class="footer-right">
        <a href="https://www.tiktok.com/@volkomennnnn" target="_blank" class="social-link">
            <img src="https://cdn.discordapp.com/emojis/1380004958329376841.webp?size=40" class="social-icon"> TikTok
        </a>
        <a href="https://www.twitch.tv/voikomenn" target="_blank" class="social-link">
            <img src="https://cdn.discordapp.com/emojis/846873277778624522.webp?size=40" class="social-icon"> Twitch
        </a>
        <a href="https://x.com/l_andrssn" target="_blank" class="social-link">
            <img src="https://cdn.discordapp.com/emojis/1157693022801235978.webp?size=40" class="social-icon"> Twitter
        </a>
        <a href="https://discordapp.com/users/943254541346930768" target="_blank" class="social-link">
            <img src="https://cdn.discordapp.com/emojis/1107191783919718400.webp?size=40" class="social-icon"> Discord: haizenshh
        </a>
    </div>
</footer>




<script>
    // --- L√ìGICA DE LOGIN, SENHA E CONTAS (ADICIONADA) ---
    let agenteLogado = null;
    let investigadorAtual = null;
    let scrollPosicaoOriginal = 0;

    function switchTab(tab) {
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const loginBtn = document.getElementById('btn-login-tab');
        const signupBtn = document.getElementById('btn-signup-tab');
        document.getElementById('login-msg').innerText = "";

        if(tab === 'login') {
            loginForm.style.display = 'block';
            signupForm.style.display = 'none';
            loginBtn.classList.add('active');
            signupBtn.classList.remove('active');
        } else {
            loginForm.style.display = 'none';
            signupForm.style.display = 'block';
            loginBtn.classList.remove('active');
            signupBtn.classList.add('active');
        }
    }

function abrirAjuda() {

    window.scrollTo({ top: 0, behavior: 'smooth' });

    
    const modal = document.getElementById('ajuda-modal');
    if(modal) {
        modal.style.setProperty('display', 'flex', 'important');
        
        // **TRAVA O SCROLL:**
        document.body.style.overflow = 'hidden';
        document.body.style.position = 'fixed';
        document.body.style.top = `-${scrollPosicaoOriginal}px`;
        document.body.style.width = '100%';
    }
}

function fecharAjuda() {
    const modal = document.getElementById('ajuda-modal');
    if(modal) {
        modal.style.setProperty('display', 'none', 'important');
        
        // **DESTRAVA O SCROLL:**
        document.body.style.removeProperty('overflow');
        document.body.style.removeProperty('position');
        document.body.style.removeProperty('top');
        document.body.style.removeProperty('width');
        
        // **VOLTA PARA A POSI√á√ÉO ORIGINAL:**
        window.scrollTo(0, scrollPosicaoOriginal);
    }
}

    function realizarCadastro() {
        const user = document.getElementById('signupUser').value.trim();
        const pass = document.getElementById('signupPass').value.trim();
        const msg = document.getElementById('login-msg');

       // Valida√ß√£o de senha forte
const senhaForte =
    pass.length >= 6 &&               // +5 caracteres
    /[A-Z]/.test(pass) &&             // 1 letra mai√∫scula
    /[a-z]/.test(pass) &&             // 1 letra min√∫scula
    /[\W_]/.test(pass) &&             // 1 caractere especial
    /\d/.test(pass);                  // 1 n√∫mero

if(!senhaForte) {
    msg.innerText =
        "A SENHA DEVE TER:\n" +
        "- 1 LETRA MAI√öSCULA\n" +
        "- 1 LETRA MIN√öSCULA\n" +
        "- 1 N√öMERO\n" +
        "- 1 CARACTERE ESPECIAL\n" +
        "- M√çNIMO 6 CARACTERES";
    return;

    
}



if(localStorage.getItem("CoC_User_" + user)) return msg.innerText = "ESTE INVESTIGADOR J√Å EST√Å REGISTRADO";
    const userData = { password: pass, investigadores: [] };
    localStorage.setItem("CoC_User_" + user, JSON.stringify(userData));
    msg.style.color = "#00ff00";
    msg.innerText = "INVESTIGADOR REGISTRADO! AGORA FA√áA LOGIN.";
    setTimeout(() => switchTab('login'), 1500);
}

function realizarLogin() {
    const user = document.getElementById('loginUser').value.trim();
    const pass = document.getElementById('loginPass').value.trim();
    const msg = document.getElementById('login-msg');

    const savedData = localStorage.getItem("CoC_User_" + user);
    if(!savedData) return msg.innerText = "AGENTE N√ÉO ENCONTRADO";
    
    const userData = JSON.parse(savedData);
    if(userData.password !== pass) return msg.innerText = "SENHA INCORRETA";

    // Define o agente logado
    agenteLogado = user;
    localStorage.setItem("Agente_Sessao_Ativa", user); 
    localStorage.setItem("usuarioLogado", user); 

    const displayBar = document.getElementById('display-username');
    if(displayBar) displayBar.innerText = user.toUpperCase();
    
    // --- GATILHO DA M√öSICA ---
    const musica = document.getElementById('bgMusic');
    if (musica) {
        musica.volume = 0.1; // Define o volume inicial baixo
        musica.play().catch(error => {
            console.log("Erro ao tocar m√∫sica: ", error);
        });
    }

    // --- PROCEDIMENTO PARA ABRIR O PAINEL ---
    document.getElementById('login-overlay').style.display = "none";
    
    // Mostrar os elementos que estavam escondidos
    document.getElementById('ficha-editor').style.display = "block";
    document.getElementById('playerMusica').style.display = "flex";
    document.getElementById('user-float-panel').style.display = "block";
    
    // Abrir menu de fichas
    document.getElementById('menu-fichas').classList.add('active'); 
    
    atualizarListaInvestigadores();
}

function abrirFicha(id) {
    const savedData = JSON.parse(localStorage.getItem("CoC_User_" + agenteLogado));
    const inv = savedData.investigadores.find(i => i.id === id);
    
    if(inv) {
        investigadorAtual = id;
        limparFicha(); 
        if(inv.ficha) aplicarDados(inv.ficha);
        
        // 1. Esconde o Menu de Sele√ß√£o
        document.getElementById('menu-fichas').classList.remove('active');
        
        // 2. Mostra a ficha e o player de m√∫sica
        document.querySelectorAll('.main-content').forEach(el => el.classList.add('visible'));
    }
}

function voltarAoMenu() {
    // Esconde a ficha/player e volta para o menu central
    document.querySelectorAll('.main-content').forEach(el => el.classList.remove('visible'));
    document.getElementById('menu-fichas').classList.add('active');
    atualizarListaInvestigadores();
}

function criarNovoInvestigador() {
    const nome = prompt("Nome do novo investigador:");
    if(!nome || !nome.trim()) return;

    const savedData = JSON.parse(localStorage.getItem("CoC_User_" + agenteLogado));
    const novoId = Date.now();
    
    const novoInv = {
        id: novoId,
        nome: nome.trim(),
        ficha: null 
    };
    
    savedData.investigadores.push(novoInv);
    localStorage.setItem("CoC_User_" + agenteLogado, JSON.stringify(savedData));
    
    // J√° abre direto para edi√ß√£o
    abrirFicha(novoId);
}

function atualizarListaInvestigadores() {
    if(!agenteLogado) return;
    const savedData = JSON.parse(localStorage.getItem("CoC_User_" + agenteLogado));
    const lista = document.getElementById('investigadores-list');
    lista.innerHTML = "";

    // Mensagem caso n√£o existam fichas
    if(!savedData.investigadores || savedData.investigadores.length === 0) {
        lista.innerHTML = `
            <div style="text-align:center; padding:40px 10px; color:#444; border:1px dashed #222; border-radius:8px;">
                <p style="font-size:11px; text-transform:uppercase;">Nenhum registro encontrado no banco de dados.</p>
            </div>`;
        return;
    }

    savedData.investigadores.forEach(inv => {
        const div = document.createElement('div');
        div.style.cssText = "background:#111; border:1px solid #222; padding:12px; margin-bottom:10px; border-radius:4px;";
        div.innerHTML = `
            <div style="color:#721717; font-size:12px; margin-bottom:10px; font-family:monospace; font-weight:bold;">
                INVESTIGADOR: ${inv.nome.toUpperCase()}
            </div>
            <div style="display:flex; gap:5px;">
                <button onclick="abrirFicha(${inv.id})" style="flex:2; background:#888; color:#333; font-size:10px;">CARREGAR</button>
                <button onclick="renomearInvestigador(${inv.id})" style="background:#222; color:#aaa; font-size:10px; padding:0 8px;">‚úé</button>
                <button onclick="removerInvestigador(${inv.id})" style="background:#330000; color:#ff4444; font-size:10px;">X</button>
            </div>
        `;
        lista.appendChild(div);
    });
}


function renomearInvestigador(id) {
    const novoNome = prompt("Digite o novo codinome do Investigador:");
    if(!novoNome || !novoNome.trim()) return;

    const savedData = JSON.parse(localStorage.getItem("CoC_User_" + agenteLogado));
    const inv = savedData.investigadores.find(i => i.id === id);
    if(inv) {
        inv.nome = novoNome.trim();
        localStorage.setItem("CoC_User_" + agenteLogado, JSON.stringify(savedData));
        atualizarListaInvestigadores();
    }
}

function carregarInvestigador(id) {
    const savedData = JSON.parse(localStorage.getItem("CoC_User_" + agenteLogado));
    const inv = savedData.investigadores.find(i => i.id === id);
    if(inv) {
        investigadorAtual = id;
        aplicarDados(inv.ficha);
        alert("Investigador '" + inv.nome + "' carregado!");
    }
}

function removerInvestigador(id) {
    if(!confirm("Tem certeza que deseja remover este investigador?")) return;
    
    const savedData = JSON.parse(localStorage.getItem("CoC_User_" + agenteLogado));
    savedData.investigadores = savedData.investigadores.filter(i => i.id !== id);
    localStorage.setItem("CoC_User_" + agenteLogado, JSON.stringify(savedData));
    
    if(investigadorAtual === id) {
        investigadorAtual = null;
        limparFicha();
    }
    
    atualizarListaInvestigadores();
}

function salvarLocal() {
    if(!agenteLogado) return alert("Fa√ßa login primeiro!");
    
    const savedData = JSON.parse(localStorage.getItem("CoC_User_" + agenteLogado));
    
    if(investigadorAtual) {
        const inv = savedData.investigadores.find(i => i.id === investigadorAtual);
        if(inv) {
            inv.ficha = colherDados();
            localStorage.setItem("CoC_User_" + agenteLogado, JSON.stringify(savedData));
            alert("Investigador '" + inv.nome + "' salvo!");
        }
    } else {
        alert("Selecione ou crie um investigador primeiro!");
    }
}

function limparFicha() {
    // Limpar campos pessoais
    document.querySelectorAll('#camposPessoais input').forEach(i => {
        if(i.id === 'idade') {
            i.value = '25';
        } else {
            i.value = '';
        }
    });
    
    // Resetar atributos
    todosAtributos.forEach(a => document.getElementById(`input-${a}`).value = '');
    
    // Resetar foto
    document.getElementById('charPhoto').src = '';
    document.getElementById('charPhoto').style.display = 'none';
    document.getElementById('placeholderTxt').style.display = 'block';
    historicoFoto = null;
    document.getElementById('btnDesfazer').disabled = true;
    document.getElementById('btnDesfazer').style.opacity = "0.5";
    
    // Resetar stats
    stats = { PV: { atual: 0, max: 0 }, SAN: { atual: 0, max: 99 }, MAG: { atual: 0, max: 0 } };
    
    // Resetar sorte
    document.getElementById('valSORTE').innerText = '-';
    
    // Resetar per√≠cias padr√£o
    listaPericias.forEach(p => {
        const id = p.n.replace(/\s+/g, '-').replace(/[()]/g, '');
        const el = document.getElementById(`p-val-${id}`);
        if(el) {
            el.value = p.v;
            calcP(id);
        }
    });
    
    // Remover per√≠cias customizadas
    document.querySelectorAll('.pericia-custom').forEach(tr => tr.remove());
    
    // Limpar armas
    document.getElementById('weaponBody').innerHTML = '';
    addWeaponRow();
    
    // Limpar dados de rolagem
    document.getElementById('diceDisplay').innerText = 'AGUARDANDO...';
    document.getElementById('diceInput').value = '';
    
    // === ADICIONE ESTAS LINHAS ===
    // Limpar checkboxes de condi√ß√µes
    document.querySelectorAll('.status-check-item input[type="checkbox"]').forEach(cb => {
        cb.checked = false;
        cb.closest('.status-check-item')?.classList.remove('checked');
    });
    
    // Limpar antecedentes
    document.querySelectorAll('[data-antecedente]').forEach(el => el.value = '');
    
    // Limpar invent√°rio
    document.getElementById('inventarioContainer').innerHTML = '';
    
    // Limpar cores de per√≠cias
    corPericiasSelecionadas = {};
    
    atualizarTudo();
}

function resetarFicha() {
    if(!confirm("Tem certeza que deseja resetar toda a ficha? Esta a√ß√£o n√£o pode ser desfeita!")) return;
    
    // 1. Limpar Campos Pessoais (Nome, Jogador, G√™nero, etc.)
    const campos = document.querySelectorAll('[data-key]');
    campos.forEach(input => {
        if(input.dataset.key === 'idade' || input.id === 'idade') {
            input.value = '25';
        } else {
            input.value = '';
        }
    });

    // Resetar ocupa√ß√£o visual
    const inputOcupacao = document.getElementById('input-ocupacao');
    if(inputOcupacao) inputOcupacao.value = '';

    // 2. Resetar Atributos Base
    todosAtributos.forEach(a => {
        const el = document.getElementById(`input-${a}`);
        if(el) el.value = '';
    });
    
    // 3. Resetar Foto
    const charPhoto = document.getElementById('charPhoto');
    const placeholder = document.getElementById('placeholderTxt');
    if(charPhoto) {
        charPhoto.src = '';
        charPhoto.style.display = 'none';
    }
    if(placeholder) placeholder.style.display = 'block';
    
    historicoFoto = null;
    const btnDesfazer = document.getElementById('btnDesfazer');
    if(btnDesfazer) {
        btnDesfazer.disabled = true;
        btnDesfazer.style.opacity = "0.5";
    }
    
    // 4. Resetar Status (PV, SAN, MAG, SORTE)
    stats = { PV: { atual: 0, max: 0 }, SAN: { atual: 0, max: 99 }, MAG: { atual: 0, max: 0 } };
    const valSorte = document.getElementById('valSORTE');
    if(valSorte) valSorte.innerText = '-';
    
    // 5. Resetar Antecedentes / Hist√≥rico
    document.querySelectorAll('[data-antecedente]').forEach(textarea => {
        textarea.value = '';
    });

    // 6. Resetar Equipamentos (Invent√°rio)
    const inventarioContainer = document.getElementById('inventarioContainer');
    if(inventarioContainer) inventarioContainer.innerHTML = '';
    
    // 7. Resetar Condi√ß√µes Especiais (Checkboxes + Estilo Vermelho)
    document.querySelectorAll('.status-check-item').forEach(item => {
        // Remove a classe que deixa o fundo vermelho/ativo
        item.classList.remove('active');
        item.style.backgroundColor = ""; // Limpa estilo direto caso exista
        item.style.color = "";           // Limpa cor do texto caso exista
        
        const cb = item.querySelector('input[type="checkbox"]');
        if(cb) cb.checked = false;
    });

    // 8. Resetar Per√≠cias (Valores + Cores de Destaque)
    listaPericias.forEach(p => {
        const id = p.n.replace(/\s+/g, '-');
        const input = document.getElementById(`p-val-${id}`);
        // Tenta encontrar o card ou a div que cont√©m a per√≠cia
        const card = document.getElementById(`p-card-${id}`) || (input ? input.closest('.pericia-item') : null);
        
        if(input) {
            input.value = p.v; 
            input.style.color = ""; // Remove o vermelho/verde do texto
            input.style.fontWeight = "normal";
            calcP(id);
        }
        
        if(card) {
            card.classList.remove('ocupacional'); // Remove a classe de destaque se existir
            card.style.backgroundColor = "";      // Remove fundo de destaque
            card.style.borderColor = "";          // Remove borda colorida
            card.style.boxShadow = "";            // Remove brilho se houver
        }
    });
    
    // Remover per√≠cias customizadas
    document.querySelectorAll('.pericia-custom').forEach(el => el.remove());
    
    // 9. Limpar Armas
    const weaponBody = document.getElementById('weaponBody');
    if(weaponBody) {
        weaponBody.innerHTML = '';
        if(typeof addWeaponRow === "function") addWeaponRow();
    }
    
    // 10. Limpar Painel de Ocupa√ß√£o
    const displayPontos = document.getElementById('display-pontos-ocupacao');
    const displayCredito = document.getElementById('credito-permitido');
    const displayInter = document.getElementById('interpessoais-qtd');
    const formula = document.getElementById('formula-usada');
    
    if(displayPontos) displayPontos.innerText = '0';
    if(displayCredito) displayCredito.innerText = 'Selecione Ocupa√ß√£o';
    if(displayInter) displayInter.innerText = 'Selecione Ocupa√ß√£o';
    if(formula) formula.innerText = '';
    
    // 11. Limpar Dados de Rolagem
    const diceDisplay = document.getElementById('diceDisplay');
    const diceInput = document.getElementById('diceInput');
    if(diceDisplay) diceDisplay.innerText = 'AGUARDANDO...';
    if(diceInput) diceInput.value = '';
    
    // 12. Resetar Padr√£o de Vida
    const padraoVida = document.getElementById('txt-padrao-vida');
    if(padraoVida) padraoVida.innerText = 'N√ÉO DEFINIDO';

    atualizarTudo();
    alert("Ficha resetada com sucesso!");
}

function colherDados() {
    const dados = {
        pessoais: {},
        atributos: {},
        pericias: {},
        periciasCustom: [],
        armas: [],
        stats: stats,
        foto: document.getElementById('charPhoto').src,
        sorte: document.getElementById('valSORTE').innerText,
        antecedentes: {},
        inventario: [],
        statusChecks: {},
        coresPericias: corPericiasSelecionadas
    };

// Captura campos pessoais
document.querySelectorAll('[data-key]').forEach(i => {
    if (i.dataset.key) {
        dados.pessoais[i.dataset.key] = i.value;
    }
});

    // Refor√ßo para ocupa√ß√£o
    if (!dados.pessoais['ocupacao']) {
        dados.pessoais['ocupacao'] = document.getElementById('input-ocupacao')?.value || "";
    }

    // Atributos
    todosAtributos.forEach(a => dados.atributos[a] = document.getElementById(`input-${a}`).value);
    
    // Per√≠cias padr√£o
    listaPericias.forEach(p => {
        const id = p.n.replace(/\s+/g, '-').replace(/[()]/g, '');
        const el = document.getElementById(`p-val-${id}`);
        if(el) dados.pericias[id] = el.value;
    });
    
    // Per√≠cias customizadas
    document.querySelectorAll('.pericia-custom').forEach(tr => {
        const inputs = tr.querySelectorAll('input');
        if(inputs.length >= 2) {
            dados.periciasCustom.push({ nome: inputs[0].value, valor: inputs[1].value });
        }
    });
    
    // Armas
    document.querySelectorAll('#weaponBody tr').forEach(tr => {
        const inputs = tr.querySelectorAll('input');
        if (inputs.length > 0) dados.armas.push(Array.from(inputs).map(i => i.value));
    });

    // Antecedentes
    document.querySelectorAll('[data-antecedente]').forEach(el => {
        dados.antecedentes[el.dataset.antecedente] = el.value;
    });

    // Invent√°rio
    document.querySelectorAll('.item-inventario').forEach(item => {
        const inputs = item.querySelectorAll('input, textarea');
        dados.inventario.push({
            nome: inputs[0]?.value || '',
            qtd: inputs[1]?.value || '',
            desc: inputs[2]?.value || ''
        });
    });

    // Status checks
    dados.statusChecks = {
        morrendo: document.getElementById('check-morrendo')?.checked || false,
        inconsciente: document.getElementById('check-inconsciente')?.checked || false,
        lesaoGrave: document.getElementById('check-lesao-grave')?.checked || false,
        insano: document.getElementById('check-insano')?.checked || false,
        temporario: document.getElementById('check-temporario')?.checked || false,
        indefinido: document.getElementById('check-indefinido')?.checked || false
    };
    
    return dados;
}

function aplicarDados(dados) {
    if(!dados) return;

 // 1. Limpar tudo antes de aplicar
    document.querySelectorAll('.pericia-custom').forEach(tr => tr.remove());
    corPericiasSelecionadas = {};

 // 2. Preencher campos pessoais
    for(let k in dados.pessoais) {
        const el = document.querySelector(`[data-key="${k}"]`);
        if(el) {
            el.value = dados.pessoais[k];
        } else {
            const elId = document.getElementById(`input-${k}`) || document.getElementById(k);
            if(elId) elId.value = dados.pessoais[k];
        }
    }

    // 3. Atributos
    for(let k in dados.atributos) {
        const el = document.getElementById(`input-${k}`);
        if(el) el.value = dados.atributos[k];
    }

// 4. Per√≠cias
    for(let k in dados.pericias) {
        const el = document.getElementById(`p-val-${k}`);
        if(el) { el.value = dados.pericias[k]; calcP(k); }
    }
    
    
    // 5. Per√≠cias customizadas
    if(dados.periciasCustom) {
        dados.periciasCustom.forEach(p => {
            if(typeof adicionarPericiaCustom === "function") {
                adicionarPericiaCustom(p.nome, p.valor);
            }
        });
    }
    
    // 6. Foto
    if(dados.foto && dados.foto.length > 10) {
        const img = document.getElementById('charPhoto');
        img.src = dados.foto; 
        img.style.display = 'block';
        document.getElementById('placeholderTxt').style.display = 'none';
    }

    
    // 7. Stats e sorte
    stats = dados.stats || { PV: { atual: 0, max: 0 }, SAN: { atual: 0, max: 99 }, MAG: { atual: 0, max: 0 } };
    document.getElementById('valSORTE').innerText = dados.sorte || "-";
    
    // 8. Armas
    const body = document.getElementById('weaponBody');
    body.innerHTML = "";
    if(dados.armas && dados.armas.length > 0) {
        dados.armas.forEach(a => {
            addWeaponRow();
            const lastRow = body.lastElementChild;
            const inputs = lastRow.querySelectorAll('input');
            a.forEach((val, i) => { if(inputs[i]) inputs[i].value = val; });
        });
    } else {
        addWeaponRow();
    }

    // 9. Antecedentes
    if (dados.antecedentes) {
        for (let k in dados.antecedentes) {
            const el = document.querySelector(`[data-antecedente="${k}"]`);
            if (el) el.value = dados.antecedentes[k];
        }
    }

    // 10. Invent√°rio
    if (dados.inventario) {
        document.getElementById('inventarioContainer').innerHTML = '';
        dados.inventario.forEach(item => {
            adicionarItemInventario(item.nome, item.qtd, item.desc);
        });
    }

    // 11. Status checks
    if (dados.statusChecks) {
        for (let k in dados.statusChecks) {
            const checkbox = document.getElementById(`check-${k.replace(/([A-Z])/g, '-$1').toLowerCase()}`);
            if (checkbox) {
                checkbox.checked = dados.statusChecks[k];
                const parent = checkbox.closest('.status-check-item');
                if (parent) {
                    parent.classList.toggle('checked', dados.statusChecks[k]);
                }
            }
        }
    }

    // 12. Cores de per√≠cias
    if (dados.coresPericias) {
        corPericiasSelecionadas = dados.coresPericias;
    }

    // Atualiza o visual sem resetar os inputs
    atualizarTudo();
}

function exportarAgente() {
    const dados = colherDados();
    const blob = new Blob([JSON.stringify(dados)], {type: "application/json"});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `FICHA_${agenteLogado}.json`;
    a.click();
}

// --- SEU C√ìDIGO ORIGINAL (MANTIDO INTEGRALMENTE) ---
const m = document.getElementById('bgMusic');
m.volume = 0.1;
window.addEventListener('load', () => { m.play().catch(() => {}); });

const bg = document.getElementById('bg-particles');

// 1. Aumente o limite do loop para ter mais quadradinhos (ex: de 150 para 300)
for (let i = 0; i < 600; i++) { 
    const sq = document.createElement('div');
    sq.className = 'square';
    
    const size = Math.random() * 15 + 5 + 'px';
    sq.style.width = size; 
    sq.style.height = size;
    sq.style.left = Math.random() * 100 + 'vw';

    // 2. Diminua os valores de animationDuration para aumentar a velocidade
    // Ex: Math.random() * 4 + 3 faz com que durem entre 3 e 7 segundos (antes era entre 8 e 18s)
    sq.style.animationDuration = Math.random() * 1 + 1 + 's'; 

    sq.style.animationDelay = Math.random() * 15 + 's';
    bg.appendChild(sq);
}

let stats = { PV: { atual: 0, max: 0 }, SAN: { atual: 0, max: 99 }, MAG: { atual: 0, max: 0 } };

function modStatus(tipo, qtd) {
    stats[tipo].atual = Math.min(stats[tipo].max, Math.max(0, stats[tipo].atual + qtd));
    updateBarVisual(tipo);
}

function modStatusMax(tipo, qtd) {
    stats[tipo].max = Math.max(0, stats[tipo].max + qtd);
    if(stats[tipo].atual > stats[tipo].max) {
        stats[tipo].atual = stats[tipo].max;
    }
    updateBarVisual(tipo);
}

function updateBarVisual(tipo) {
    const percent = stats[tipo].max > 0 ? (stats[tipo].atual / stats[tipo].max) * 100 : 0;
    const fillEl = document.getElementById(`fill-${tipo}`);
    if(fillEl) fillEl.style.width = percent + "%";
    document.getElementById(`txt-${tipo}`).innerText = `${stats[tipo].atual} / ${stats[tipo].max}`;
}

function updateBarVisual(tipo) {
    const percent = stats[tipo].max > 0 ? (stats[tipo].atual / stats[tipo].max) * 100 : 0;
    const fillEl = document.getElementById(`fill-${tipo}`);
    if(fillEl) fillEl.style.width = percent + "%";
    document.getElementById(`txt-${tipo}`).innerText = `${stats[tipo].atual} / ${stats[tipo].max}`;
}

let historicoFoto = null;
function carregarFoto(event) {
    const reader = new FileReader();
    const img = document.getElementById('charPhoto');
    reader.onload = () => {
        historicoFoto = img.src;
        document.getElementById('btnDesfazer').disabled = false;
        document.getElementById('btnDesfazer').style.opacity = "1";
        img.src = reader.result; img.style.display = 'block';
        document.getElementById('placeholderTxt').style.display = 'none';
    }
    if(event.target.files[0]) reader.readAsDataURL(event.target.files[0]);
}

function removerFoto() {
    const img = document.getElementById('charPhoto');
    if (img.src && img.style.display !== 'none') {
        historicoFoto = img.src;
        document.getElementById('btnDesfazer').disabled = false;
        document.getElementById('btnDesfazer').style.opacity = "1";
        img.src = ""; img.style.display = 'none';
        document.getElementById('placeholderTxt').style.display = 'block';
    }
}

function desfazerFoto() {
    if (historicoFoto) {
        const img = document.getElementById('charPhoto');
        const fotoAtual = img.src;
        img.src = historicoFoto; img.style.display = 'block';
        document.getElementById('placeholderTxt').style.display = 'none';
        historicoFoto = fotoAtual; 
    }
}

function calcWeapon(input) {
    const row = input.closest('tr');
    const val = parseInt(input.value) || 0;
    const cells = row.querySelectorAll('.val-auto');
    if(cells.length >= 2) {
        cells[0].value = Math.floor(val / 2);
        cells[1].value = Math.floor(val / 5);
    }
}

function addWeaponRow() {
    const body = document.getElementById('weaponBody');
    const tr = document.createElement('tr');
    tr.innerHTML = `
        <td><input type="text" placeholder="Arma"></td>
        <td><input type="number" oninput="calcWeapon(this)" placeholder="Reg."></td>
        <td><input type="text" class="val-auto" readonly value="0"></td>
        <td><input type="text" class="val-auto" readonly value="0"></td>
        <td><input type="text" placeholder="1D10"></td>
        <td><input type="text" placeholder="15m"></td>
        <td><input type="text" placeholder="1"></td>
        <td><input type="text" placeholder="6"></td>
        <td><input type="text" placeholder="98"></td>
        <td><button class="btn-remove-weapon" onclick="this.closest('tr').remove()">X</button></td>
    `;
    body.appendChild(tr);
}

const attrTipoA = ["FOR", "CON", "DES", "POD", "APA"]; 
const attrTipoB = ["TAM", "INT", "EDU"]; 
const todosAtributos = [...attrTipoA, ...attrTipoB];
const attrContainer = document.getElementById('attrContainer');

// Dicion√°rio com descri√ß√µes dos atributos
const descAtributos = {
    FOR: "<b style='color:#721717'>FOR√áA:</b><br>0: Incapaz de ficar de p√©<br>15: Franzino, fraco<br>50: For√ßa m√©dia<br>90: Uma das pessoas mais fortes<br>99: M√°ximo humano (atleta ol√≠mpico)<br>140+: Al√©m da for√ßa humana<br>200+: For√ßa monstruosa",
    CON: "<b style='color:#721717'>CONSTITUI√á√ÉO:</b><br>0: Morto<br>15: Sa√∫de fraca<br>50: Humano saud√°vel<br>90: Vigoroso e dur√£o<br>99: Constitui√ß√£o de ferro<br>140+: Al√©m da constitui√ß√£o humana<br>200+: Constitui√ß√£o monstruosa, imune √† maioria das doen√ßas terrestres",
    TAM: "<b style='color:#721717'>TAMANHO:</b><br>1: Beb√™ (0,5-6kg)<br>15: Crian√ßa/An√£o (15kg)<br>60: Tamanho m√©dio (75kg)<br>80: Muito alto, robusto ou obeso (110kg)<br>99: Fora do comum (150kg)<br>150: Cavalo ou vaca (436 kg)<br>180: Humano mais pesado ja registrado (634 kg)<br>200+: Gigantes (872 kg)<br>Nota: Humanos pode ultrapassar TAM 99",
    DES: "<b style='color:#721717'>DESTREZA:</b><br>0: Incapaz de se mover sem assist√™ncia<br>15: Lento e desajeitado<br>50: Destreza m√©dia<br>90: √Ågil (ex.: acrobata)<br>99: Atleta mundial (m√°ximo humano)<br>120: Al√©m da destreza humana (ex.: Tigre)<br>200+: Destreza de um rel√¢mpago, capaz de se mover ou realizar proezas potencialmente mais r√°pidas do que um humano conseguiria compreender",
    APA: "<b style='color:#721717'>APAR√äNCIA:</b><br>0: T√£o grotesco que sentem medo ou remorso<br>15: Feio/desfigurado<br>50: Apar√™ncia m√©dia<br>90: Muito bonito<br>99: √Åpice da beleza (supermodelo)<br>Nota: Apar√™ncia normalmente √© usado apenas para seres humanos e n√£o excede 99.",
    INT: "<b style='color:#721717'>INTELIG√äNCIA:</b><br>0: Sem intelecto<br>15: Aprendizado lento<br>50: Intelig√™ncia m√©dia<br>90: Muito inteligente<br>99: G√™nio (Einstein)<br>140+: Al√©m do intelecto humano",
    POD: "<b style='color:#721717'>PODER:</b><br>0: Mente debilitada<br>15: Mente fraca<br>50: M√©dia humana<br>90: Voluntarioso, determinado, um alto potencial de conex√£o com o invis√≠vel e o m√°gico<br>100: Vontade de ferro, forte conex√£o com o ''reino''' espiritual ou o mundo invis√≠vel.<br>140:  Al√©m do humano, possivelmente alien√≠gena<br>210+: Potencial m√°gico monstruoso e poder al√©m da compreens√£o humana (ex.: O Grande Cthulhu)<br>Nota: O POD humano pode exceder 100, mas isso √© excepcional",
    EDU: "<b style='color:#721717'>EDUCA√á√ÉO:</b><br>0: Beb√™<br>15: N√£o instru√≠do<br>60: Ensino m√©dio<br>70: Universit√°rio<br>80: Graduado<br>90: Doutorado<br>96: Autoridade mundial<br>99: M√°ximo humano"
};

todosAtributos.forEach(attr => {
    attrContainer.innerHTML += `
        <div class="attr-card" style="position: relative;">
            <div class="attr-tooltip">${descAtributos[attr]}</div>
            <label>${attr}</label>
            <input type="number" id="input-${attr}" oninput="atualizarTudo()" min="0">
            <button style="width:100%; margin-top:8px; font-size:9px;" onclick="testarHabilidade('${attr}', document.getElementById('input-${attr}').value)">TESTAR</button>
            <div class="sub-vals">¬Ω: <span id="half-${attr}">0</span> | ‚Öï: <span id="fifth-${attr}">0</span></div>
        </div>
    `;
});

const listaPericias = [
    { n: "Antropologia", v: 1, d: "Identifica h√°bitos, costumes e a cultura de um grupo. √ötil para prever comportamentos humanos baseados na tradi√ß√£o." }, 
    { n: "Armas de Fogo (Pistolas)", v: 20, d: "Capacidade de disparar e manter armas de punho, como rev√≥lveres e pistolas semi-autom√°ticas." },
    { n: "Armas de Fogo (Rifles/Espingardas)", v: 20, d: "Uso de armas longas. Rifles possuem longo alcance, enquanto espingardas espalham o dano." }, 
    { n: "Arqueologia", v: 1, d: "Estudo de ru√≠nas e artefatos antigos. Permite datar objetos e identificar culturas extintas." },
    { n: "Arremessar", v: 20, d: "Habilidade de lan√ßar objetos com precis√£o, desde uma pedra at√© uma granada ou faca." },
    { n: "Arte e Of√≠cio", v: 5, d: "Capacidade de criar ou consertar itens art√≠sticos ou t√©cnicos (Carpintaria, Pintura, Culin√°ria, etc.)." },
    { n: "Avalia√ß√£o", v: 5, d: "Estima o valor de mercado e a autenticidade de objetos, antiguidades e bens." },
    { n: "Charme", v: 15, d: "Uso de sedu√ß√£o, bajula√ß√£o ou apar√™ncia para conseguir o que quer de algu√©m." },
    { n: "Chaveiro", v: 1, d: "Habilidade de abrir trancas, cofres e portas trancadas sem a chave original." }, 
    { n: "Ci√™ncia", v: 1, d: "Conhecimento acad√™mico em √°reas como Biologia, Qu√≠mica ou F√≠sica (especifique a √°rea)." },
    { n: "Consertos El√©tricos", v: 10, d: "Reparar ou sabotar dispositivos el√©tricos, fia√ß√µes e pain√©is de controle." },
    { n: "Consertos Mec√¢nicos", v: 10, d: "Reparar ou entender o funcionamento de m√°quinas, motores e engrenagens." }, 
    { n: "Contabilidade", v: 5, d: "Examinar registros financeiros para encontrar inconsist√™ncias, desvios ou origens de dinheiro." },
    { n: "Direito", v: 5, d: "Conhecimento de leis, precedentes judiciais e procedimentos policiais/legais." },
    { n: "Dirigir Autom√≥vel", v: 20, d: "Conduzir ve√≠culos terrestres sob press√£o, realizar persegui√ß√µes ou manobras arriscadas." }, 
    { n: "Disfarce", v: 5, d: "Mudar a apar√™ncia e o comportamento para se passar por outra pessoa ou ocultar a identidade." },
    { n: "Eletr√¥nica", v: 1, d: "Conserto e cria√ß√£o de aparelhos complexos, como r√°dios, microchips e sistemas de vigil√¢ncia." },
    { n: "Encontrar", v: 25, d: "Percep√ß√£o visual para notar itens escondidos, pistas sutis ou detalhes em uma cena." },
    { n: "Escalar", v: 20, d: "Subir superf√≠cies verticais, como muros, √°rvores ou encostas rochosas." }, 
    { n: "Escutar", v: 20, d: "Capacidade de ouvir sons baixos, conversas atrav√©s de portas ou detectar algu√©m se aproximando." },
    { n: "Esquivar", v: 0, d: "Capacidade de se desviar de ataques f√≠sicos. O valor inicial √© sempre metade da sua DESTREZA." }, 
    { n: "Furtividade", v: 20, d: "Mover-se em sil√™ncio e esconder-se nas sombras para evitar ser detectado." },
    { n: "Hist√≥ria", v: 20, d: "Lembrar-se de fatos hist√≥ricos, datas importantes e eventos que moldaram o passado." },
    { n: "Intimida√ß√£o", v: 15, d: "For√ßar algu√©m a agir atrav√©s de amea√ßas f√≠sicas, verbais ou for√ßa de personalidade." },
    { n: "L√°bia", v: 5, d: "Enganar as pessoas com mentiras r√°pidas, confus√£o ou papo furado." },
    { n: "L√≠ngua (Nativa)", v: 0, d: "Dom√≠nio do seu idioma original. O valor inicial √© igual ao seu atributo EDUCA√á√ÉO." },
    { n: "L√≠ngua (Outra)", v: 1, d: "Conhecimento de idiomas estrangeiros ou l√≠nguas mortas (como Latim ou Grego)." },
    { n: "Lutar (Briga)", v: 25, d: "Combate corpo a corpo desarmado ou com armas improvisadas (facas, porretes)." }, 
    { n: "Medicina", v: 1, d: "Diagnosticar doen√ßas, realizar cirurgias e tratar ferimentos graves a longo prazo." },
    { n: "Mythos de Cthulhu", v: 0, d: "Conhecimento sobre os horrores c√≥smicos. Reduz sua Sanidade M√°xima conforme aumenta." },
    { n: "Mundo Natural", v: 10, d: "Conhecimento de bot√¢nica, zoologia e fen√¥menos meteorol√≥gicos." }, 
    { n: "Nata√ß√£o", v: 10, d: "Capacidade de se manter √† tona e nadar em √°guas calmas ou agitadas sob estresse." },
    { n: "Navega√ß√£o", v: 10, d: "Orientar-se em alto mar ou em locais desconhecidos usando mapas, b√∫ssolas ou estrelas." },
    { n: "N√≠vel de Cr√©dito", v: 0, d: "Determina seu padr√£o de vida e sua influ√™ncia financeira na sociedade." },
    { n: "Ocultismo", v: 5, d: "Conhecimento sobre rituais, cren√ßas esot√©ricas e folclore m√≠stico (n√£o necessariamente real)." }, 
    { n: "Operar Maquin√°rio", v: 1, d: "Uso de m√°quinas pesadas, como guindastes, prensas industriais ou trens." },
    { n: "Persuas√£o", v: 10, d: "Convencer algu√©m atrav√©s de argumentos l√≥gicos, debates ou orat√≥ria honesta." },
    { n: "Pilotar", v: 1, d: "Conduzir barcos, avi√µes ou dirig√≠veis (especifique o tipo de ve√≠culo)." },
    { n: "Prestidigita√ß√£o", v: 10, d: "Truques de m√£os, bater carteiras ou ocultar pequenos objetos no corpo sem ser visto." },
    { n: "Primeiros Socorros", v: 30, d: "Tratamento emergencial para estabilizar feridos e recuperar 1 ponto de vida imediatamente." },
    { n: "Psican√°lise", v: 1, d: "Tratar traumas mentais e ajudar investigadores a recuperarem pontos de Sanidade." },
    { n: "Psicologia", v: 1, d: "Observar algu√©m para detectar mentiras, inten√ß√µes ocultas ou estado emocional." },
    { n: "Rastrear", v: 10, d: "Seguir pegadas ou marcas deixadas por humanos ou criaturas em diversos terrenos." }, 
    { n: "Saltar", v: 20, d: "Pular dist√¢ncias horizontais ou verticais e amortecer quedas de alturas baixas." },
    { n: "Sobreviv√™ncia", v: 10, d: "Capacidade de encontrar comida, √°gua e abrigo em ambientes hostis (Deserto, Floresta, etc.). Est√£o inclu√≠dos conhecimentos sobre ca√ßa, constru√ß√£o de abrigos, perigos (como evitar plantas venenosas), etc., de acordo com o ambiente em quest√£o." }, 
    { n: "Usar Bibliotecas", v: 20, d: "Habilidade de encontrar informa√ß√µes espec√≠ficas em livros, jornais e registros p√∫blicos." },
    { n: "Usar Computadores", v: 5, d: "Hackear sistemas, recuperar arquivos apagados ou navegar em bancos de dados complexos." }
];

function renderPericias() {
    const container = document.getElementById('periciasContainer');
    container.innerHTML = "";
    const metade = Math.ceil(listaPericias.length / 2);

    for (let i = 0; i < 2; i++) {
        const table = document.createElement('table');
        table.className = "pericias-table";
        table.innerHTML = `<thead><tr><th>PER√çCIA</th><th>REG.</th><th>S√ìL.</th><th>EXT.</th><th>üé≤</th></tr></thead><tbody id="p-body-${i}"></tbody>`;
        container.appendChild(table);

        const slice = listaPericias.slice(i * metade, (i + 1) * metade);
        const tbody = document.getElementById(`p-body-${i}`);

        slice.forEach(p => {
            const idSafe = p.n.replace(/\s+/g, '-').replace(/[()]/g, '');
            const descricao = p.d || "Sem descri√ß√£o dispon√≠vel.";
            const isCredito = (p.n === "N√≠vel de Cr√©dito");
            const borderClass = isCredito ? "borda-amarela-animada" : "borda-padrao";
            
            const corAtual = corPericiasSelecionadas[idSafe];
            const corTexto = corAtual !== undefined ? coresPericias[corAtual] : (isCredito ? '#ff0' : '#888');

            const tr = document.createElement('tr');
            tr.id = `row-${idSafe}`;
            tr.innerHTML = `
                <td style="text-align:left;">
                    <div style="display: flex; flex-direction: column; gap: 5px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div class="tooltip-wrapper" style="flex: 1;">
                                <span class="pericia-nome" style="color: ${corTexto}; ${corAtual !== undefined ? `text-shadow: 0 0 5px ${corTexto};` : ''}">
                                    ${p.n}
                                </span>
                                <div class="tooltip-box ${borderClass}">${descricao}</div>
                            </div>
                            <button class="btn-toggle-cor" onclick="toggleSeletorCor('${idSafe}', this)">COR</button>
                            <button class="btn-reset-cor" onclick="removerCorPericia('${idSafe}')" title="Remover Cor">X</button>
                        </div>
                        <div id="cores-${idSafe}" class="pericia-color-marker">
                            ${renderizarSeletorCor(idSafe)}
                        </div>
                    </div>
                </td>
                <td><input type="number" value="${p.v}" id="p-val-${idSafe}" oninput="calcP('${idSafe}')"></td>
                <td><input type="text" class="val-auto" id="p-half-${idSafe}" readonly value="${Math.floor(p.v/2)}"></td>
                <td><input type="text" class="val-auto" id="p-fifth-${idSafe}" readonly value="${Math.floor(p.v/5)}"></td>
                <td><button onclick="testarHabilidade('${p.n}', document.getElementById('p-val-${idSafe}').value)">üé≤</button></td>
            `;
            tbody.appendChild(tr);
        });
    }
}

function adicionarPericiaCustom(nomePredef = null, valorPredef = null) {
    const nome = nomePredef || prompt("Nome da nova per√≠cia:");
    if(!nome || !nome.trim()) return;
    
    const valor = valorPredef !== null ? valorPredef : (prompt("Valor inicial (0-100):") || "0");
    
    const table = document.querySelector('.pericias-table');
    const tbody = table.querySelector('tbody');
    const tr = document.createElement('tr');
    tr.className = 'pericia-custom';
    
    const idSafe = 'custom-' + Date.now();
    const valorNum = parseInt(valor) || 0;
    
    tr.id = `row-${idSafe}`;
    tr.innerHTML = `
        <td style="text-align:left;">
            <div style="display: flex; flex-direction: column; gap: 5px;">
                <div style="display: flex; justify-content: space-between; align-items: center; gap: 5px;">
                    <input type="text" value="${nome}" style="background: transparent; border: none; color: #00ff00; flex: 1; min-width: 0;">
                    <button class="btn-toggle-cor" onclick="toggleSeletorCor('${idSafe}', this)">COR</button>
                </div>
                <div id="cores-${idSafe}" class="pericia-color-marker">
                    ${renderizarSeletorCor(idSafe)}
                </div>
            </div>
        </td>
        <td><input type="number" value="${valorNum}" id="p-val-${idSafe}" oninput="calcP('${idSafe}')"></td>
        <td><input type="text" class="val-auto" id="p-half-${idSafe}" readonly value="${Math.floor(valorNum/2)}"></td>
        <td><input type="text" class="val-auto" id="p-fifth-${idSafe}" readonly value="${Math.floor(valorNum/5)}"></td>
        <td>
            <button style="padding:2px 8px; font-size:10px;" onclick="testarHabilidade('${nome}', document.getElementById('p-val-${idSafe}').value)">üé≤</button>
            <button class="btn-remove-weapon" onclick="this.closest('tr').remove()" style="margin-left: 3px;">X</button>
        </td>
    `;
    
    tbody.appendChild(tr);
}

// 1. COLOQUE ESTA FUN√á√ÉO PRIMEIRO
function atualizarPadraoVida(valor) {
    const box = document.getElementById('box-padrao-vida');
    const txt = document.getElementById('txt-padrao-vida');
    
    // Se os elementos n√£o existirem na tela ainda, sai da fun√ß√£o sem dar erro
    if (!box || !txt) return;

    let v = parseInt(valor) || 0;
    let info = { nome: "N√ÉO DEFINIDO", desc: "", classe: "" };

    if (v === 0) {
        info = { nome: "Pobret√£o", desc: "Uma pessoa que sequer pode pagar pelo n√≠vel de ''pobre'' √© considerada um pobret√£o.", classe: "vida-pobretao" };
    } else if (v <= 9) {
        info = { nome: "Pobre", desc: "Capaz de pagar por um teto qualquer sobre a cabe√ßa e pelo menos uma parca refei√ß√£o por dia.", classe: "vida-pobre" };
    } else if (v <= 49) {
        info = { nome: "M√©dio", desc: "Um n√≠vel razo√°vel de conforto, tr√™s refei√ß√µes por dia e uma divers√£o ocasional.", classe: "vida-medio" };
    } else if (v <= 89) {
        info = { nome: "Abastado", desc: "Este n√≠vel de riqueza oferece luxo e conforto. ", classe: "vida-abastado" };
    } else if (v <= 98) {
        info = { nome: "Rico", desc: "Este n√≠vel de riqueza proporciona grande luxo e conforto.", classe: "vida-rico" };
    } else {
        info = { nome: "Rica√ßo", desc: "Como o Rico, mas dinheiro realmente n√£o √© problema. Os indiv√≠duos desta categoria est√£o entre os mais ricos do mundo.", classe: "vida-rico" };
    }

    txt.innerText = info.nome;
    box.title = info.desc;
    box.className = "box-vida " + info.classe;
}

// 2. DEPOIS COLOQUE A CALCP
function calcP(idSafe) {
    const valInput = document.getElementById(`p-val-${idSafe}`);
    const halfInput = document.getElementById(`p-half-${idSafe}`);
    const fifthInput = document.getElementById(`p-fifth-${idSafe}`);

    if (valInput) {
        const v = parseInt(valInput.value) || 0;
        if (halfInput) halfInput.value = Math.floor(v / 2);
        if (fifthInput) fifthInput.value = Math.floor(v / 5);

        // Verifica se a fun√ß√£o existe antes de chamar para evitar o erro de 'not defined'
        if (idSafe === "N√≠vel-de-Cr√©dito" && typeof atualizarPadraoVida === "function") {
            atualizarPadraoVida(v);
        }
    }
}


function testarHabilidade(nome, valorAlvo) {
    const alvo = parseInt(valorAlvo) || 0;
    const roll = Math.floor(Math.random() * 100) + 1;
    const half = Math.floor(alvo / 2); 
    const fifth = Math.floor(alvo / 5);
    const overlay = document.getElementById('result-overlay');
    
    let title = "FALHA", detail = `${roll} VS ${alvo}`, c="#666", b="#111";
    
    if (roll === 1) { 
        title="CR√çTICO"; c="#000"; b="#fff"; 
    }
    else if (roll <= fifth) { 
        title="EXTREMO"; c="#fff"; b="#333"; 
    }
    else if (roll <= half) { 
        title="S√ìLIDO"; c="#fff"; b="#666"; 
    }
    else if (roll <= alvo) { 
        title="REGULAR"; c="#000"; b="#999"; 
    }
    else if (roll >= 96 && alvo < 50) { 
        title="DESASTRE"; c="#f00"; b="#300"; 
    }
    else if (roll === 100) { 
        title="DESASTRE"; c="#f00"; b="#300"; 
    }

    
    // === L√ìGICA DOS PAIN√âIS EXPANS√çVEIS ===
    const painelAtributos = document.getElementById('painel-resultado-atributos');
    const textoAtributo = document.getElementById('texto-resultado-atributo');
    const painelPericias = document.getElementById('painel-resultado-pericias');
    const textoPericias = document.getElementById('texto-resultado-pericias');
    
    // Detecta se √© atributo (verificando se est√° na lista todosAtributos)
    const ehAtributo = todosAtributos.includes(nome);
    
    if (ehAtributo && painelAtributos && textoAtributo) {
        // √â um atributo - mostra painel de atributos
        textoAtributo.innerHTML = `<b style="color: #721717">${nome}:</b> <span style="color: ${c}">${title}</span><br><span style="color: #888">${detail}</span>`;
        painelAtributos.style.maxHeight = "200px";
        painelAtributos.style.padding = "15px 0";
        painelAtributos.style.marginTop = "20px";
        
        // Fecha ap√≥s 3.2s
        setTimeout(() => {
            painelAtributos.style.maxHeight = "0";
            painelAtributos.style.padding = "0";
            painelAtributos.style.marginTop = "0";
        }, 3200);
        
    } else if (!ehAtributo && painelPericias && textoPericias) {
        // √â uma per√≠cia - mostra painel de per√≠cias
        textoPericias.innerHTML = `<b style="color: #721717">${nome}:</b> <span style="color: ${c}">${title}</span><br><span style="color: #888">${detail}</span>`;
        painelPericias.style.maxHeight = "200px";
        painelPericias.style.padding = "15px 0";
        painelPericias.style.marginBottom = "20px";
        
        // Fecha ap√≥s 3.2s
        setTimeout(() => {
            painelPericias.style.maxHeight = "0";
            painelPericias.style.padding = "0";
            painelPericias.style.marginBottom = "0";
        }, 3200);
    }
}

function rollXDX(qtd, lados) {
    let total = 0; let rolls = [];
    for (let i = 0; i < qtd; i++) {
        let r = Math.floor(Math.random() * lados) + 1;
        rolls.push(r); total += r;
    }
    return { total, formula: rolls.join(' + ') + ' = ' + total };
}

function rollCustomDice() {
    const input = document.getElementById('diceInput').value;
    const m = input.match(/(\d+)d(\d+)/i);
    if (m) {
        const res = rollXDX(m[1], m[2]);
        document.getElementById('diceDisplay').innerText = res.formula;
    }
}

function atualizarTudo() {
    let v = {};
    todosAtributos.forEach(attr => {
        const el = document.getElementById(`input-${attr}`);
        v[attr] = parseInt(el.value) || 0;
        document.getElementById(`half-${attr}`).innerText = Math.floor(v[attr] / 2);
        document.getElementById(`fifth-${attr}`).innerText = Math.floor(v[attr] / 5);

        calcularPontosOcupacao();
        
        
    });
    const esquivaInput = document.getElementById('p-val-Esquivar');
    if(esquivaInput) {
        const novaEsquiva = Math.floor(v.DES / 2);
        esquivaInput.value = novaEsquiva;
        calcP('Esquivar');
        document.getElementById('valESQUIVA').innerText = novaEsquiva;
    }
    
   // CORRE√á√ÉO: Atualizar PV, SAN e MAG corretamente
const pvAntigo = stats.PV.max;
const podAntigo = stats.SAN.atual; // Guarda o POD antigo
const magAntigo = stats.MAG.max;

stats.PV.max = Math.floor((v.TAM + v.CON) / 10);
stats.SAN.max = 99; // Sanidade m√°xima sempre 99
stats.SAN.atual = v.POD; // Sanidade atual = POD
stats.MAG.max = Math.floor(v.POD / 5);

// Atualizar valores atuais para PV e MAG quando mudarem
if(pvAntigo !== stats.PV.max) {
    stats.PV.atual = stats.PV.max;
}
if(magAntigo !== stats.MAG.max) {
    stats.MAG.atual = stats.MAG.max;
}

// Garantir que atual n√£o exceda o m√°ximo
stats.PV.atual = Math.min(stats.PV.atual, stats.PV.max);
stats.SAN.atual = Math.min(stats.SAN.atual, stats.SAN.max); // N√£o pode passar de 99
stats.MAG.atual = Math.min(stats.MAG.atual, stats.MAG.max);

// Garantir que atual n√£o exceda o m√°ximo
stats.PV.atual = Math.min(stats.PV.atual, stats.PV.max);
stats.SAN.atual = Math.min(stats.SAN.atual, stats.SAN.max);
stats.MAG.atual = Math.min(stats.MAG.atual, stats.MAG.max);
    
    updateBarVisual('PV'); 
    updateBarVisual('SAN'); 
    updateBarVisual('MAG');
    
    const soma = v.FOR + v.TAM;
    let dx = "0";
    let corpo = 0;

    // Tabela Completa de Dano Extra (DX) e Corpo (Build)
    if (soma <= 64) { 
        dx = "-2"; corpo = -2; 
    } else if (soma <= 84) { 
        dx = "-1"; corpo = -1; 
    } else if (soma <= 124) { 
        dx = "0"; corpo = 0; 
    } else if (soma <= 164) { 
        dx = "+1D4"; corpo = 1; 
    } else if (soma <= 204) { 
        dx = "+1D6"; corpo = 2; 
    } else if (soma <= 284) { 
        dx = "+2D6"; corpo = 3; 
    } else if (soma <= 364) { 
        dx = "+3D6"; corpo = 4; 
    } else if (soma <= 444) { 
        dx = "+4D6"; corpo = 5; 
    } else { 
        // Acima de 445 pontos
        dx = "+5D6"; corpo = 6; 
    }

    // Aplica os resultados nos elementos da ficha
    document.getElementById('valDX').innerText = dx;
    document.getElementById('valCorpo').innerText = corpo;

// 2. Pegar a idade atual do input
const idade = parseInt(document.getElementById('idade').value) || 0;

// --- C√ÅLCULO DO MOV BASE (Regra Cthulhu 7ed) ---
let movBase = 8; // Valor padr√£o

// Precisamos dos valores de FOR, DES e TAM que est√£o dentro do objeto 'v'
if (v.FOR < v.TAM && v.DES < v.TAM) {
    movBase = 7;
} else if (v.FOR > v.TAM || v.DES > v.TAM || v.TAM <= 0) { // TAM <= 0 evita bugs se o campo estiver vazio
    movBase = 9;
    // Se FOR e DES forem maiores que TAM, o MOV √© 9. 
    // Se FOR e DES forem iguais a TAM, o MOV √© 8.
} else {
    movBase = 8;
}

// 2. Pegar a idade atual do input
const idadeValor = parseInt(document.getElementById('idade').value) || 0;

// 3. Calcular a penalidade baseada na faixa et√°ria
let penalidadeIdade = 0;
if (idadeValor >= 80) {
    penalidadeIdade = 5;
} else if (idadeValor >= 70) {
    penalidadeIdade = 4;
} else if (idadeValor >= 60) {
    penalidadeIdade = 3;
} else if (idadeValor >= 50) {
    penalidadeIdade = 2;
} else if (idadeValor >= 40) {
    penalidadeIdade = 1;
}

// 4. Aplicar a penalidade (garantindo que o MOV m√≠nimo seja 1)
const movFinal = Math.max(1, movBase - penalidadeIdade);

// 5. Exibir o resultado final no campo correto
const campoMOV = document.getElementById('valMOV');
if (campoMOV) {
    campoMOV.innerText = movFinal;
}

}

function gerarTodosAtributos() {
    attrTipoA.forEach(a => document.getElementById(`input-${a}`).value = rollXDX(3, 6).total * 5);
    attrTipoB.forEach(b => document.getElementById(`input-${b}`).value = (rollXDX(2, 6).total + 6) * 5);
    rolarSorte(); 
    atualizarTudo();
}

function rolarSorte() {
    const sorte = rollXDX(3, 6).total * 5;
    document.getElementById('valSORTE').innerText = sorte;
}

// Monitora o campo de senha em tempo real
document.getElementById('signupPass').addEventListener('input', function() {
    const pass = this.value;

    // Defini√ß√£o dos requisitos
    const checks = {
        "req-length": pass.length >= 6,
        "req-upper": /[A-Z]/.test(pass),
        "req-lower": /[a-z]/.test(pass),
        "req-number": /\d/.test(pass),
        "req-special": /[\W_]/.test(pass)
    };

    // Aplica a classe 'valid' (verde) ou remove (vermelho) para cada item
    for (const [id, isValid] of Object.entries(checks)) {
        const el = document.getElementById(id);
        if (isValid) {
            el.classList.add('valid');
        } else {
            el.classList.remove('valid');
        }
    }
});

// Ajuste na sua fun√ß√£o de cadastro original:
function realizarCadastro() {
    const user = document.getElementById('signupUser').value.trim();
    const pass = document.getElementById('signupPass').value.trim();
    const msg = document.getElementById('login-msg');

    // Verifica se todos os elementos t√™m a classe 'valid'
    const todosValidos = document.querySelectorAll('.req-item.valid').length === 5;

    if(!todosValidos) {
        msg.style.color = "#ff4444";
        msg.innerText = "PREENCHA TODOS OS REQUISITOS DA SENHA";
        return;
    }

    if(localStorage.getItem("CoC_User_" + user)) return msg.innerText = "ESTE INVESTIGADOR J√Å EST√Å REGISTRADO";
    
    const userData = { password: pass, investigadores: [] };
    localStorage.setItem("CoC_User_" + user, JSON.stringify(userData));
    msg.style.color = "#00ff00";
    msg.innerText = "INVESTIGADOR REGISTRADO COM SUCESSO!";
    setTimeout(() => switchTab('login'), 1500);
}


// FUN√á√ÉO PARA EXPORTAR APENAS A FICHA ATUAL
function exportarFichaJSON() {
    const dados = colherDados();
    
    // REFOR√áO PARA SORTE: Pega o texto do elemento que voc√™ definiu
    const elementoSorte = document.getElementById('valSORTE');
    if (elementoSorte) {
        dados.sorte = elementoSorte.innerText;
    }

    const blob = new Blob([JSON.stringify(dados, null, 2)], {type: "application/json"});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    
    // Nome do arquivo baseado no nome do investigador ou no login
    const nomeArquivo = dados.pessoais.nome || agenteLogado || "Investigador";
    a.download = `FICHA_${nomeArquivo}.json`;
    a.click();
}

// FUN√á√ÉO PARA IMPORTAR
function importarFichaJSON(event) {
    const arquivo = event.target.files[0];
    if (!arquivo) return;

    const leitor = new FileReader();
    leitor.onload = function(e) {
        try {
            const dados = JSON.parse(e.target.result);
            
            // 1. Aplica os dados b√°sicos (isso j√° usa sua fun√ß√£o aplicarDados)
            aplicarDados(dados);

            // 2. REFOR√áO PARA SORTE: Garante que o texto mude na tela
            const elementoSorte = document.getElementById('valSORTE');
            if (elementoSorte && dados.sorte) {
                elementoSorte.innerText = dados.sorte;
            }

            // 3. REFOR√áO PARA FOTO: Garante que o placeholder suma
            if (dados.foto && dados.foto.length > 10) {
                const img = document.getElementById('charPhoto');
                const placeholder = document.getElementById('placeholderTxt');
                img.src = dados.foto;
                img.style.display = 'block';
                if (placeholder) placeholder.style.display = 'none';
            }

            alert("‚úÖ Ficha carregada com sucesso!");
        } catch (err) {
            alert("‚ùå Erro ao ler o arquivo JSON.");
            console.error(err);
        }
    };
    leitor.readAsText(arquivo);
}


function minimizarPlayer() {
    const player = document.getElementById('playerMusica');
    player.classList.toggle('player-minimizado');
    
    // Altera o s√≠mbolo do bot√£o dependendo do estado
    const btn = player.querySelector('.btn-janelinha');
    if(player.classList.contains('player-minimizado')) {
        btn.innerText = "üóñ"; // S√≠mbolo de expandir
    } else {
        btn.innerText = "üóó"; // S√≠mbolo de janelinha/minimizar
    }
}

function minimizarFichas() {
    const painel = document.getElementById('menu-fichas');
    painel.classList.toggle('panel-minimizado');
    
    const btn = painel.querySelector('.btn-janelinha-fichas');
    if(painel.classList.contains('panel-minimizado')) {
        btn.innerText = "üóñ";
    } else {
        btn.innerText = "üóó";
    }
}

function fazerLogout() {
    // 1. Limpa as sess√µes do navegador
    localStorage.removeItem("Agente_Sessao_Ativa");
    localStorage.removeItem("usuarioLogado");

    // 2. Feedback visual (opcional)
    console.log("Sess√£o encerrada.");

    // 3. For√ßa a p√°gina a recarregar do zero. 
    // Como o seu 'login-overlay' √© vis√≠vel por padr√£o, ele voltar√° a aparecer.
    location.reload(); 
}


// Esta fun√ß√£o roda automaticamente quando a p√°gina abre
window.addEventListener('load', () => {
    const usuarioSalvo = localStorage.getItem("Agente_Sessao_Ativa");

    if (usuarioSalvo && localStorage.getItem("CoC_User_" + usuarioSalvo)) {
        agenteLogado = usuarioSalvo;
        document.getElementById('login-overlay').style.display = "none";
        document.getElementById('menu-fichas').classList.add('active');
        
        atualizarListaInvestigadores();
        
        // Espera um pouco para os dados preencherem a tela e calcula
        setTimeout(() => {
            atualizarTudo();
            calcularPontosOcupacao();
            console.log("C√°lculos autom√°ticos aplicados para: " + usuarioSalvo);
        }, 500); 
        // --------------------------------

// ... dentro do load ...
const zoom = localStorage.getItem('noir_fundo_zoom') || '100';

if (bg) {
    if (!(tp && tp.includes('video'))) {
        document.body.style.background = `url('${bg}') no-repeat ${posX}% ${posY}% fixed`;
        document.body.style.backgroundSize = `${zoom}%`; // Aplica o zoom salvo
    }
}

if (document.getElementById('zoomFundo')) {
    document.getElementById('zoomFundo').value = zoom;
    document.getElementById('valorZoom').innerText = zoom + '%';
}

    }
});


const dadosOcupacoes = {
    "Advogado": {
        credito: "30‚Äì80",
        interpessoais: 2,
        texto: "EDU √ó 4",
        formula: (a) => a.EDU * 4,
        lista: "Contabilidade, Direito, Usar Bibliotecas, duas per√≠cias interpessoais, Psicologia, outras duas per√≠cias."
    },
    "Andarilho": {
        credito: "0‚Äì5",
        interpessoais: 1,
        texto: "EDU √ó 2 + (APA, DES ou FOR) √ó 2",
        formula: (a) => (a.EDU * 2) + (Math.max(a.APA, a.DES, a.FOR) * 2),
        lista: "Escalar, Saltar, Escutar, Navega√ß√£o, uma per√≠cia interpessoal, Furtividade, outras duas per√≠cias."
    },
    "Antiqu√°rio": {
        credito: "30‚Äì70",
        interpessoais: 1,
        texto: "EDU √ó 4",
        formula: (a) => a.EDU * 4,
        lista: "Avalia√ß√£o, Arte/Of√≠cio, Hist√≥ria, Usar Bibliotecas, Outra L√≠ngua, uma per√≠cia interpessoal, Encontrar, uma outra per√≠cia."
    },
    "Artista": {
        credito: "9‚Äì50",
        interpessoais: 1,
        texto: "EDU √ó 2 + (POD ou DES) √ó 2",
        formula: (a) => (a.EDU * 2) + (Math.max(a.POD, a.DES) * 2),
        lista: "Arte/Of√≠cio, Hist√≥ria ou Mundo Natural, uma per√≠cia interpessoal, Outra L√≠ngua, Psicologia, Encontrar, outras duas per√≠cias."
    },
    "Atleta": {
        credito: "9‚Äì70",
        interpessoais: 1,
        texto: "EDU √ó 2 + (DES ou FOR) √ó 2",
        formula: (a) => (a.EDU * 2) + (Math.max(a.DES, a.FOR) * 2),
        lista: "Escalar, Saltar, Lutar (Briga), Cavalgar, uma per√≠cia interpessoal, Nata√ß√£o, Arremessar, uma outra per√≠cia."
    },
    "Autor": {
        credito: "9‚Äì30",
        interpessoais: 0,
        texto: "EDU √ó 4",
        formula: (a) => a.EDU * 4,
        lista: "Arte (Literatura), Hist√≥ria, Usar Bibliotecas, Mundo Natural ou Ocultismo, Outra L√≠ngua, L√≠ngua Nativa, Psicologia, uma outra per√≠cia."
    },
    "Bibliotec√°rio": {
        credito: "9‚Äì35",
        interpessoais: 0,
        texto: "EDU √ó 4",
        formula: (a) => a.EDU * 4,
        lista: "Contabilidade, Usar Bibliotecas, Outra L√≠ngua, L√≠ngua Nativa, outras quatro per√≠cias como especialidades."
    },
    "Clero, Membro do": {
        credito: "9‚Äì60",
        interpessoais: 1,
        texto: "EDU √ó 4",
        formula: (a) => a.EDU * 4,
        lista: "Contabilidade, Hist√≥ria, Usar Bibliotecas, Escutar, Outra L√≠ngua, uma per√≠cia interpessoal, Psicologia, uma outra per√≠cia."
    },
    "Criminoso": {
        credito: "5‚Äì65",
        interpessoais: 1,
        texto: "EDU √ó 2 + (DES ou FOR) √ó 2",
        formula: (a) => (a.EDU * 2) + (Math.max(a.DES, a.FOR) * 2),
        lista: "Uma per√≠cia interpessoal, Psicologia, Encontrar, Furtividade, mais quatro entre: Avalia√ß√£o, Disfarce, Lutar, Armas de Fogo, Chaveiro, Consertos Mec√¢nicos e Prestidigita√ß√£o."
    },
    "Detetive Particular": {
        credito: "9‚Äì30",
        interpessoais: 1,
        texto: "EDU √ó 2 + (DES ou FOR) √ó 2",
        formula: (a) => (a.EDU * 2) + (Math.max(a.DES, a.FOR) * 2),
        lista: "Arte/Of√≠cio (Fotografia), Disfarce, Direito, Usar Bibliotecas, uma per√≠cia interpessoal, Psicologia, Encontrar, uma outra per√≠cia."
    },
    "Diletante": {
        credito: "50‚Äì99",
        interpessoais: 1,
        texto: "EDU √ó 2 + APA √ó 2",
        formula: (a) => (a.EDU * 2) + (a.APA * 2),
        lista: "Arte/Of√≠cio, Armas de Fogo, Outra L√≠ngua, Cavalgar, uma per√≠cia interpessoal, outras tr√™s per√≠cias."
    },
    "Engenheiro": {
        credito: "30‚Äì60",
        interpessoais: 0,
        texto: "EDU √ó 4",
        formula: (a) => a.EDU * 4,
        lista: "Arte/Of√≠cio (Desenho T√©cnico), Consertos El√©tricos, Usar Bibliotecas, Consertos Mec√¢nicos, Operar Maquin√°rio Pesado, Ci√™ncias (Engenharia e F√≠sica), uma outra per√≠cia."
    },
    "Fan√°tico": {
        credito: "0‚Äì30",
        interpessoais: 2,
        texto: "EDU √ó 2 + (APA ou POD) √ó 2",
        formula: (a) => (a.EDU * 2) + (Math.max(a.APA, a.POD) * 2),
        lista: "Hist√≥ria, duas per√≠cias interpessoais, Psicologia, Furtividade, tr√™s outras per√≠cias."
    },
    "Fazendeiro": {
        credito: "9‚Äì30",
        interpessoais: 1,
        texto: "EDU √ó 2 + (DES ou FOR) √ó 2",
        formula: (a) => (a.EDU * 2) + (Math.max(a.DES, a.FOR) * 2),
        lista: "Arte/Of√≠cio (Trabalhos de Fazenda), Dirigir Autom√≥veis (ou Carro√ßa), uma per√≠cia interpessoal, Consertos Mec√¢nicos, Mundo Natural, Operar Maquin√°rio Pesado, Rastrear, uma outra per√≠cia."
    },
    "Hacker": {
        credito: "10‚Äì70",
        interpessoais: 1,
        texto: "EDU √ó 4",
        formula: (a) => a.EDU * 4,
        lista: "Usar Computadores, Consertos El√©tricos, Eletr√¥nica, Usar Bibliotecas, Encontrar, uma per√≠cia interpessoal, duas outras per√≠cias."
    },
    "Investigador de Pol√≠cia": {
        credito: "20‚Äì50",
        interpessoais: 1,
        texto: "EDU √ó 2 + (DES ou FOR) √ó 2",
        formula: (a) => (a.EDU * 2) + (Math.max(a.DES, a.FOR) * 2),
        lista: "Arte/Of√≠cio (Atuar) ou Disfarce, Armas de Fogo, Direito, Escutar, uma per√≠cia interpessoal, Psicologia, Encontrar, uma outra per√≠cia."
    },
    "Jornalista": {
        credito: "9‚Äì30",
        interpessoais: 1,
        texto: "EDU √ó 4",
        formula: (a) => a.EDU * 4,
        lista: "Artes/Of√≠cio (Fotografia), Hist√≥ria, Usar Bibliotecas, L√≠ngua Nativa, uma per√≠cia interpessoal, Psicologia, duas outras per√≠cias."
    },
    "M√©dico": {
        credito: "30‚Äì80",
        interpessoais: 0,
        texto: "EDU √ó 4",
        formula: (a) => a.EDU * 4,
        lista: "Primeiros Socorros, Outra L√≠ngua (Latim), Medicina, Psicologia, Ci√™ncias (Biologia e Farm√°cia), duas outras per√≠cias."
    },
    "Membro de Tribo": {
        credito: "0‚Äì15",
        interpessoais: 0,
        texto: "EDU √ó 2 + (DES ou FOR) √ó 2",
        formula: (a) => (a.EDU * 2) + (Math.max(a.DES, a.FOR) * 2),
        lista: "Escalar, Lutar ou Arremessar, Mundo Natural, Escutar, Ocultismo, Encontrar, Nata√ß√£o, Sobreviv√™ncia."
    },
    "Mission√°rio": {
        credito: "0‚Äì30",
        interpessoais: 1,
        texto: "EDU √ó 4",
        formula: (a) => a.EDU * 4,
        lista: "Arte/Of√≠cio, Primeiros Socorros, Consertos Mec√¢nicos, Medicina, Mundo Natural, uma per√≠cia interpessoal, duas outras per√≠cias."
    },
    "M√∫sico": {
        credito: "9‚Äì30",
        interpessoais: 1,
        texto: "EDU √ó 2 + (DES ou POD) √ó 2",
        formula: (a) => (a.EDU * 2) + (Math.max(a.DES, a.POD) * 2),
        lista: "Arte/Of√≠cio (instrumento), uma per√≠cia interpessoal, Escutar, Psicologia, quatro outras per√≠cias."
    },
    "Oficial de Pol√≠cia": {
        credito: "9‚Äì30",
        interpessoais: 1,
        texto: "EDU √ó 2 + (DES ou FOR) √ó 2",
        formula: (a) => (a.EDU * 2) + (Math.max(a.DES, a.FOR) * 2),
        lista: "Lutar (Briga), Armas de Fogo, Primeiros Socorros, uma per√≠cia interpessoal, Direito, Psicologia, Encontrar e (Dirigir ou Cavalgar)."
    },
    "Oficial Militar": {
        credito: "20‚Äì70",
        interpessoais: 2,
        texto: "EDU √ó 2 + (DES ou FOR) √ó 2",
        formula: (a) => (a.EDU * 2) + (Math.max(a.DES, a.FOR) * 2),
        lista: "Contabilidade, Armas de Fogo, Navega√ß√£o, duas per√≠cias interpessoais, Psicologia, Sobreviv√™ncia, uma outra per√≠cia."
    },
    "Parapsic√≥logo": {
        credito: "9‚Äì30",
        interpessoais: 0,
        texto: "EDU √ó 4",
        formula: (a) => a.EDU * 4,
        lista: "Antropologia, Arte/Of√≠cio (Fotografia), Hist√≥ria, Usar Bibliotecas, Ocultismo, Outra L√≠ngua, Psicologia, uma outra per√≠cia."
    },
    "Piloto": {
        credito: "20‚Äì70",
        interpessoais: 0,
        texto: "EDU √ó 2 + DES √ó 2",
        formula: (a) => (a.EDU * 2) + (a.DES * 2),
        lista: "Consertos El√©tricos, Consertos Mec√¢nicos, Navega√ß√£o, Operar Maquin√°rio Pesado, Piloto (aeronave), Ci√™ncias (Astronomia), duas outras per√≠cias."
    },
    "Professor": {
        credito: "20‚Äì70",
        interpessoais: 0,
        texto: "EDU √ó 4",
        formula: (a) => a.EDU * 4,
        lista: "Usar Bibliotecas, Outra L√≠ngua, L√≠ngua Nativa, Psicologia, outras quatro per√≠cias acad√™micas."
    },
    "Profissional de Entretenimento": {
        credito: "9-70",
        interpessoais: 2,
        texto: "EDU √ó 2 + APA √ó 2",
        formula: (a) => (a.EDU * 2) + (a.APA * 2),
        lista: "Arte/Of√≠cio (Atuar), Disfarce, duas per√≠cias interpessoais, Escutar, Psicologia, duas outras per√≠cias."
    },
    "Soldado": {
        credito: "9‚Äì30",
        interpessoais: 0,
        texto: "EDU √ó 2 + (DES ou FOR) √ó 2",
        formula: (a) => (a.EDU * 2) + (Math.max(a.DES, a.FOR) * 2),
        lista: "Escalar ou Nata√ß√£o, Esquivar, Lutar, Armas de Fogo, Furtividade, Sobreviv√™ncia e duas entre: Primeiros Socorros, Consertos Mec√¢nicos ou Outra L√≠ngua."
    }
};

// Fun√ß√£o para calcular os pontos baseada na ocupa√ß√£o atual
function calcularPontosOcupacao() {
    const inputOcupa = document.getElementById('input-ocupacao');
    const display = document.getElementById('display-pontos-ocupacao');
    const formulaLabel = document.getElementById('formula-usada');
    const creditoEl = document.getElementById('credito-permitido');
    const interpessoaisEl = document.getElementById('interpessoais-qtd');

    if (!inputOcupa || !display) return;

    const nomeOcupacao = inputOcupa.value;
    const ocupacao = dadosOcupacoes[nomeOcupacao];

    if (ocupacao) {
        const atributos = {
            FOR: parseInt(document.getElementById('input-FOR')?.value) || 0,
            DES: parseInt(document.getElementById('input-DES')?.value) || 0,
            EDU: parseInt(document.getElementById('input-EDU')?.value) || 0,
            APA: parseInt(document.getElementById('input-APA')?.value) || 0,
            POD: parseInt(document.getElementById('input-POD')?.value) || 0,
            TAM: parseInt(document.getElementById('input-TAM')?.value) || 0
        };

        const pontos = ocupacao.formula(atributos);
        display.innerText = pontos;
        
        if (formulaLabel) formulaLabel.innerText = ocupacao.texto;
        if (creditoEl) creditoEl.innerText = ocupacao.credito;
        
        if (interpessoaisEl) {
            // Criando o HTML do Tooltip
            const plural = ocupacao.interpessoais > 1 ? 's' : '';
            const countStr = ocupacao.interpessoais === 0 ? "Nenhuma" : ocupacao.interpessoais;
            
            interpessoaisEl.innerHTML = `
                <span class="tooltip-pericias">
                    ${countStr} obrigat√≥ria${plural}
                    <span class="tooltip-text">
                        <strong>PER√çCIAS DA OCUPA√á√ÉO:</strong><br><br>
                        ${ocupacao.lista}
                    </span>
                </span>
            `;
        }
    } else {
        display.innerText = "0";
        if (formulaLabel) formulaLabel.innerText = "SELECIONE UMA OCUPA√á√ÉO";
        if (creditoEl) creditoEl.innerText = "-";
        if (interpessoaisEl) interpessoaisEl.innerHTML = "-";
    }
}



function abrirModalOcupacoes() {

window.scrollTo({ top: 0, behavior: 'smooth' });
    
    const modal = document.getElementById('modal-ocupacoes');
    const grid = document.getElementById('lista-ocupacoes-grid');

    // Preenche o grid (Garante que dadosOcupacoes existe)
    if (typeof dadosOcupacoes !== 'undefined') {
        grid.innerHTML = "";
        Object.keys(dadosOcupacoes).forEach(ocupa => {
            const btn = document.createElement('button');
            btn.className = 'btn-ocupacao-item';
            btn.innerText = ocupa;
            btn.onclick = () => selecionarOcupacao(ocupa);
            grid.appendChild(btn);
        });
    }

    modal.style.display = 'flex';

    // Trava o scroll
    document.body.style.overflow = 'hidden';
    document.body.style.position = 'fixed';
    document.body.style.top = `-${scrollPosicaoOriginal}px`;
    document.body.style.width = '100%';
}

function fecharModalOcupacoes() {
    const modal = document.getElementById('modal-ocupacoes');
    if (modal) modal.style.display = 'none';

    // DESTRAVA o scroll limpando todas as propriedades
    document.body.style.removeProperty('overflow');
    document.body.style.removeProperty('position');
    document.body.style.removeProperty('top');
    document.body.style.removeProperty('width');

    // Volta para a posi√ß√£o onde o usu√°rio estava
    window.scrollTo(0, scrollPosicaoOriginal);
}

function selecionarOcupacao(nome) {
    const input = document.getElementById('input-ocupacao');
    
    if (input) {
        input.value = nome;
        console.log("Ocupa√ß√£o selecionada:", nome);

        fecharModalOcupacoes();
        calcularPontosOcupacao();
        
        // === ADICIONE ESTA LINHA AQUI ===
        marcarPericiasOcupacionais(nome);
        
        input.dispatchEvent(new Event('input'));
    } else {
        console.error("Erro: N√£o encontrei o campo 'input-ocupacao'!");
    }
}

// === SISTEMA DE CORES PARA PER√çCIAS ===
const coresPericias = [
    '#ff0000', // Vermelho
    '#00ff00', // Verde
    '#0080ff', // Azul
    '#ffff00', // Amarelo
    '#ff00ff', // Magenta
    '#00ffff', // Ciano
    '#ff8000', // Laranja
    '#8000ff', // Roxo
    '#ffffff'  // Branco
];

let corPericiasSelecionadas = {}; // Armazena {idPericia: corIndex}

function renderizarSeletorCor(idPericia) {
    let html = '';
    coresPericias.forEach((cor, index) => {
        const selected = corPericiasSelecionadas[idPericia] === index ? 'selected' : '';
        html += `<div class="color-cube ${selected}" 
                     style="background: ${cor};" 
                     onclick="selecionarCorPericia('${idPericia}', ${index}, '${cor}')"></div>`;
    });
    return html;
}

function selecionarCorPericia(idPericia, corIndex, corHex) {
    corPericiasSelecionadas[idPericia] = corIndex;
    
    // Atualiza visual do nome da per√≠cia
    const nomeEl = document.querySelector(`#row-${idPericia} .pericia-nome`);
    if (nomeEl) {
        nomeEl.style.color = corHex;
        nomeEl.style.textShadow = `0 0 5px ${corHex}`;
    }
    
    // Re-renderiza os cubinhos
    const coresDiv = document.getElementById(`cores-${idPericia}`);
    if (coresDiv) {
        coresDiv.innerHTML = renderizarSeletorCor(idPericia);
    }
}

// === ADICIONE ESTA FUN√á√ÉO AQUI ===
function toggleSeletorCor(idPericia, btnElement) {
    const coresDiv = document.getElementById(`cores-${idPericia}`);
    if (!coresDiv) return;
    
    // Toggle de visibilidade
    coresDiv.classList.toggle('visible');
    
    // Atualiza visual do bot√£o
    btnElement.classList.toggle('active');
    
    // Fecha outros seletores abertos (opcional, para manter apenas 1 aberto por vez)
    document.querySelectorAll('.pericia-color-marker.visible').forEach(el => {
        if (el.id !== `cores-${idPericia}`) {
            el.classList.remove('visible');
        }
    });
    
    document.querySelectorAll('.btn-toggle-cor.active').forEach(btn => {
        if (btn !== btnElement) {
            btn.classList.remove('active');
        }
    });
}

// === MARCAR PER√çCIAS OCUPACIONAIS ===
const periciasOcupacionais = {
    "Advogado": ["Contabilidade", "Direito", "Usar Bibliotecas", "Psicologia"],
    "Andarilho": ["Escalar", "Saltar", "Escutar", "Navega√ß√£o", "Furtividade"],
    "Antiqu√°rio": ["Avalia√ß√£o", "Arte e Of√≠cio", "Hist√≥ria", "Usar Bibliotecas", "Encontrar"],
    "Artista": ["Arte e Of√≠cio", "Hist√≥ria", "Mundo Natural", "Psicologia", "Encontrar"],
    "Atleta": ["Escalar", "Saltar", "Lutar (Briga)", "Nata√ß√£o", "Arremessar"],
    "Autor": ["Hist√≥ria", "Usar Bibliotecas", "Mundo Natural", "Ocultismo", "Psicologia"],
    "Bibliotec√°rio": ["Contabilidade", "Usar Bibliotecas"],
    "Clero, Membro do": ["Contabilidade", "Hist√≥ria", "Usar Bibliotecas", "Escutar", "Psicologia"],
    "Criminoso": ["Psicologia", "Encontrar", "Furtividade", "Avalia√ß√£o", "Disfarce", "Lutar (Briga)", "Armas de Fogo (Pistolas)", "Chaveiro", "Consertos Mec√¢nicos", "Prestidigita√ß√£o"],
    "Detetive Particular": ["Arte e Of√≠cio", "Disfarce", "Direito", "Usar Bibliotecas", "Psicologia", "Encontrar"],
    "Diletante": ["Arte e Of√≠cio", "Armas de Fogo (Pistolas)", "Armas de Fogo (Rifles/Espingardas)"],
    "Engenheiro": ["Arte e Of√≠cio", "Consertos El√©tricos", "Usar Bibliotecas", "Consertos Mec√¢nicos", "Operar Maquin√°rio", "Ci√™ncia"],
    "Fan√°tico": ["Hist√≥ria", "Psicologia", "Furtividade"],
    "Fazendeiro": ["Arte e Of√≠cio", "Dirigir Autom√≥vel", "Consertos Mec√¢nicos", "Mundo Natural", "Operar Maquin√°rio", "Rastrear"],
    "Hacker": ["Usar Computadores", "Consertos El√©tricos", "Eletr√¥nica", "Usar Bibliotecas", "Encontrar"],
    "Investigador de Pol√≠cia": ["Arte e Of√≠cio", "Disfarce", "Armas de Fogo (Pistolas)", "Direito", "Escutar", "Psicologia", "Encontrar"],
    "Jornalista": ["Arte e Of√≠cio", "Hist√≥ria", "Usar Bibliotecas", "Psicologia"],
    "M√©dico": ["Primeiros Socorros", "Medicina", "Psicologia", "Ci√™ncia"],
    "Membro de Tribo": ["Escalar", "Lutar (Briga)", "Arremessar", "Mundo Natural", "Escutar", "Ocultismo", "Encontrar", "Nata√ß√£o", "Sobreviv√™ncia"],
    "Mission√°rio": ["Arte e Of√≠cio", "Primeiros Socorros", "Consertos Mec√¢nicos", "Medicina", "Mundo Natural"],
    "M√∫sico": ["Arte e Of√≠cio", "Escutar", "Psicologia"],
    "Oficial de Pol√≠cia": ["Lutar (Briga)", "Armas de Fogo (Pistolas)", "Primeiros Socorros", "Direito", "Psicologia", "Encontrar", "Dirigir Autom√≥vel"],
    "Oficial Militar": ["Contabilidade", "Armas de Fogo (Rifles/Espingardas)", "Navega√ß√£o", "Psicologia", "Sobreviv√™ncia"],
    "Parapsic√≥logo": ["Antropologia", "Arte e Of√≠cio", "Hist√≥ria", "Usar Bibliotecas", "Ocultismo", "Psicologia"],
    "Piloto": ["Consertos El√©tricos", "Consertos Mec√¢nicos", "Navega√ß√£o", "Operar Maquin√°rio", "Pilotar", "Ci√™ncia"],
    "Professor": ["Usar Bibliotecas", "Psicologia"],
    "Profissional de Entretenimento": ["Arte e Of√≠cio", "Disfarce", "Escutar", "Psicologia"],
    "Soldado": ["Escalar", "Nata√ß√£o", "Esquivar", "Lutar (Briga)", "Armas de Fogo (Rifles/Espingardas)", "Furtividade", "Sobreviv√™ncia", "Primeiros Socorros", "Consertos Mec√¢nicos"]
};

function marcarPericiasOcupacionais(ocupacao) {
    const pericias = periciasOcupacionais[ocupacao];
    if (!pericias) return;
    
    // Limpa todas as cores vermelhas antes
    Object.keys(corPericiasSelecionadas).forEach(id => {
        if (corPericiasSelecionadas[id] === 0) { // 0 = vermelho
            delete corPericiasSelecionadas[id];
        }
    });
    
    // Marca as novas per√≠cias em vermelho
    pericias.forEach(nomePericia => {
        const idSafe = nomePericia.replace(/\s+/g, '-').replace(/[()]/g, '');
        const row = document.getElementById(`row-${idSafe}`);
        if (row) {
            corPericiasSelecionadas[idSafe] = 0; // Vermelho
        }
    });
    
    renderPericias();
}

// === SISTEMA DE ABAS ===
function trocarAba(nomeAba) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
    document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active'));
    
    document.getElementById(`tab-${nomeAba}`).classList.add('active');
    event.target.classList.add('active');
}

// === INVENT√ÅRIO ===
function adicionarItemInventario(nome = '', qtd = '', desc = '') {
    const container = document.getElementById('inventarioContainer');
    const div = document.createElement('div');
    div.className = 'item-inventario';
    div.innerHTML = `
        <input type="text" placeholder="Nome do Item" value="${nome}">
        <input type="text" placeholder="Quantidade" value="${qtd}">
        <textarea placeholder="Descri√ß√£o/Notas" style="min-height: 60px;">${desc}</textarea>
        <button onclick="this.closest('.item-inventario').remove()" 
                style="background: #300; padding: 5px; font-size: 9px;">REMOVER</button>
    `;
    container.appendChild(div);
}

// === STATUS CHECKS ===
function toggleStatusCheck(element, tipo) {
    const checkbox = element.querySelector('input[type="checkbox"]');
    checkbox.checked = !checkbox.checked;
    
    if (checkbox.checked) {
        element.classList.add('checked');
    } else {
        element.classList.remove('checked');
    }
}


function removerCorPericia(idSafe) {
    // 1. Remove do registro de cores
    delete corPericiasSelecionadas[idSafe];

    // 2. Reseta o visual do nome da per√≠cia
    const nomeEl = document.querySelector(`#row-${idSafe} .pericia-nome`);
    if (nomeEl) {
        // Verifica se √© N√≠vel de Cr√©dito para voltar ao amarelo, sen√£o volta ao cinza padr√£o
        const isCredito = (idSafe === "N√≠vel-de-Cr√©dito");
        nomeEl.style.color = isCredito ? '#ff0' : '#888';
        nomeEl.style.textShadow = 'none';
    }

    // 3. Fecha o seletor de cores se estiver aberto e limpa os cubinhos selecionados
    const coresDiv = document.getElementById(`cores-${idSafe}`);
    if (coresDiv) {
        coresDiv.classList.remove('visible');
        coresDiv.innerHTML = renderizarSeletorCor(idSafe);
    }
    
    // 4. Remove o estado 'active' do bot√£o COR correspondente
    const btnCor = document.querySelector(`#row-${idSafe} .btn-toggle-cor`);
    if (btnCor) btnCor.classList.remove('active');
}


let ultimaIdadeAlertada = null;

// Objeto para guardar os valores originais e n√£o perder pontos ao trocar de idade
let atributosBase = null;
let logIdadeAtual = "Nenhuma altera√ß√£o aplicada.";

function salvarValoresBase() {
    const lista = ['FOR', 'CON', 'DES', 'TAM', 'APA', 'EDU'];
    atributosBase = {};
    lista.forEach(attr => {
        const el = document.getElementById(`input-${attr}`);
        if(el) atributosBase[attr] = parseInt(el.value) || 0;
    });
}

function aplicarRegrasIdade() {
    // Removemos a parte de salvar atributosBase e resetar valores para n√£o mexer nos inputs
    const idade = parseInt(document.getElementById('idade').value);
    if (!idade) return;

    let modLog = "";

    // REGRAS (Mantendo exatamente o seu texto)
    if (idade >= 15 && idade <= 19) {
        modLog = "<b style='color:#721717'>JOVEM:</b><br>‚Ä¢ -5 pts distribu√≠dos entre FOR e TAM<br>‚Ä¢ -5 EDU<br>‚Ä¢ Fa√ßa duas jogadas para o valor de SORTE e use o valor mais alto.";
    } else if (idade >= 20 && idade <= 39) {
        modLog = "<b style='color:#721717'>ADULTO:</b><br>‚Ä¢ 1 Verifica√ß√£o de EDU (Role sua EDU, se o valor for maior, adicione 1d10 pontos ao atributo de EDU).";
    } else if (idade >= 40 && idade <= 49) {
        modLog = "<b style='color:#721717'>MATURIDADE:</b><br>‚Ä¢ 2 Verif. EDU (Role sua EDU, se o valor for maior, adicione 1d10 pontos ao atributo de EDU).<br>‚Ä¢ -5 pts distribu√≠dos entre FOR, CON e DES<br>‚Ä¢ -5 APA";
    } else if (idade >= 50 && idade <= 59) {
        modLog = "<b style='color:#721717'>MEIA IDADE:</b><br>‚Ä¢ 3 Verif. EDU (Role sua EDU, se o valor for maior, adicione 1d10 pontos ao atributo de EDU).<br>‚Ä¢ -10 pts distribu√≠dos entre FOR, CON e DES<br>‚Ä¢ -10 APA";
    } else if (idade >= 60 && idade <= 69) {
        modLog = "<b style='color:#721717'>S√äNIOR:</b><br>‚Ä¢ 4 Verif. EDU (Role sua EDU, se o valor for maior, adicione 1d10 pontos ao atributo de EDU).<br>‚Ä¢ -20 pts distribu√≠dos entre FOR, CON e DES<br>‚Ä¢ -15 APA";
    } else if (idade >= 70 && idade <= 79) {
        modLog = "<b style='color:#721717'>ANCI√ÉO:</b><br>‚Ä¢ 4 Verif. EDU (Role sua EDU, se o valor for maior, adicione 1d10 pontos ao atributo de EDU).<br>‚Ä¢ -40 pts distribu√≠dos entre FOR, CON e DES<br>‚Ä¢ -20 APA";
    } else if (idade >= 80 && idade <= 89) {
        modLog = "<b style='color:#721717'>VENER√ÅVEL:</b><br>‚Ä¢ 4 Verif. EDU (Role sua EDU, se o valor for maior, adicione 1d10 pontos ao atributo de EDU).<br>‚Ä¢ -80 pts distribu√≠dos entre FOR, CON e DES<br>‚Ä¢ -25 APA";
    } else {
        modLog = "Idade fora da faixa padr√£o (15-89). Consulte o Guardi√£o.";
    }
    
    // Atualiza o conte√∫do do tooltip (bal√£o)
    const tooltipConteudo = document.getElementById('tooltip-idade-conteudo');
    if (tooltipConteudo) {
        tooltipConteudo.innerHTML = modLog;
    }

    // Mantemos o atualizarTudo apenas para o caso da idade influenciar o MOV (Movimento)
    if (typeof atualizarTudo === "function") atualizarTudo();
}

// Fun√ß√µes de Controle do Tooltip
function mostrarTooltipIdade() { document.getElementById('tooltip-idade').style.display = 'block'; }
function esconderTooltipIdade() { document.getElementById('tooltip-idade').style.display = 'none'; }

function subtrairAtributo(id, valor) {
    const el = document.getElementById(`input-${id}`);
    if (el) el.value = Math.max(0, parseInt(el.value) - valor);
}

function distribuirPenalidade(lista, total) {
    while (total > 0) {
        let alterou = false;
        lista.forEach(attr => {
            const el = document.getElementById(`input-${attr}`);
            if (el && parseInt(el.value) > 1 && total > 0) {
                el.value = parseInt(el.value) - 1;
                total--;
                alterou = true;
            }
        });
        if (!alterou) break;
    }
}


/* ============================================================
   SISTEMA DE CUSTOMIZA√á√ÉO
   ============================================================ */



/* --- SISTEMA DE AMBIENTE CORRIGIDO --- */

// Fun√ß√£o mestre para aplicar o fundo com todas as vari√°veis simultaneamente
window.aplicarConfiguracoesFundo = function() {
    const bg = localStorage.getItem('noir_fundo_data');
    const tp = localStorage.getItem('noir_fundo_tipo');
    const posX = localStorage.getItem('noir_fundo_posX') || '50';
    const posY = localStorage.getItem('noir_fundo_posY') || '50';
    const zoom = localStorage.getItem('noir_fundo_zoom') || '100';

    if (bg) {
        if (tp && tp.includes('video')) {
            const vCont = document.getElementById('video-bg-container');
            const vEl = document.getElementById('video-bg-element');
            if (vCont) vCont.style.display = 'block';
            if (vEl && vEl.src !== bg) { vEl.src = bg; vEl.play(); }
            document.body.style.background = "#000";
        } else {
            // AQUI EST√Å O SEGREDO: Unificar posi√ß√£o e tamanho num comando s√≥
            document.body.style.background = `url('${bg}') no-repeat ${posX}% ${posY}% fixed`;
            document.body.style.backgroundSize = `${zoom}%`;
        }
    }
};

window.abrirPainelFundo = function() {
    const painel = document.getElementById('painelFundo');
    if(painel) {
        window.scrollTo({ top: 0, behavior: 'smooth' });
        painel.style.setProperty('display', 'block', 'important');
        document.body.style.overflow = 'hidden'; 
    }
};

window.fecharPainelFundo = function() {
    const painel = document.getElementById('painelFundo');
    if(painel) {
        painel.style.setProperty('display', 'none', 'important');
        document.body.style.overflow = 'auto';
    }
};

window.ajustarOpacidadeFicha = function(val) {
    const seletores = ['.main-content', '.container', '.music-player-container', '#ficha-editor', '.user-account-bar'];
    seletores.forEach(sel => {
        document.querySelectorAll(sel).forEach(el => {
            el.style.setProperty('background-color', `rgba(10, 10, 10, ${val})`, 'important');
        });
    });
    localStorage.setItem('opacidade_ficha_noir', val);
};

window.ajustarOpacidadeFundo = function(val) {
    const escurecimento = 1 - val;
    const overlay = document.getElementById('overlay-escurecedor');
    if(overlay) overlay.style.opacity = escurecimento;
    localStorage.setItem('brilho_fundo_noir', val);
};

window.ajustarPosicaoFundo = function() {
    const x = document.getElementById('posicaoX').value;
    const y = document.getElementById('posicaoY').value;
    document.getElementById('valorX').innerText = x + '%';
    document.getElementById('valorY').innerText = y + '%';
    
    localStorage.setItem('noir_fundo_posX', x);
    localStorage.setItem('noir_fundo_posY', y);
    window.aplicarConfiguracoesFundo();
};

window.ajustarZoomFundo = function(val) {
    document.getElementById('valorZoom').innerText = val + '%';
    localStorage.setItem('noir_fundo_zoom', val);
    window.aplicarConfiguracoesFundo();
};

window.processarArquivoFundo = function(input) {
    const file = input.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        const data = e.target.result;
        localStorage.setItem('noir_fundo_data', data);
        localStorage.setItem('noir_fundo_tipo', file.type);
        window.aplicarConfiguracoesFundo();
    };
    reader.readAsDataURL(file);
};

// Restaurar TUDO ao carregar a p√°gina (F5)
window.addEventListener('load', () => {
    const posX = localStorage.getItem('noir_fundo_posX') || '50';
    const posY = localStorage.getItem('noir_fundo_posY') || '50';
    const zoom = localStorage.getItem('noir_fundo_zoom') || '100';
    const opFicha = localStorage.getItem('opacidade_ficha_noir');
    const opFundo = localStorage.getItem('brilho_fundo_noir');

    // Sincroniza os inputs da interface
    if (document.getElementById('posicaoX')) {
        document.getElementById('posicaoX').value = posX;
        document.getElementById('posicaoY').value = posY;
        document.getElementById('valorX').innerText = posX + '%';
        document.getElementById('valorY').innerText = posY + '%';
    }
    if (document.getElementById('zoomFundo')) {
        document.getElementById('zoomFundo').value = zoom;
        document.getElementById('valorZoom').innerText = zoom + '%';
    }

    // Aplica o fundo com as coordenadas salvas
    window.aplicarConfiguracoesFundo();

    if (opFicha) window.ajustarOpacidadeFicha(opFicha);
    if (opFundo) window.ajustarOpacidadeFundo(opFundo);
});

window.removerFundo = function() {
    document.body.style.background = "#000";
    const vCont = document.getElementById('video-bg-container');
    if(vCont) vCont.style.display = 'none';
    localStorage.removeItem('noir_fundo_data');
    localStorage.removeItem('noir_fundo_tipo');
};

window.redefinirTudo = function() {
    if(confirm("Deseja resetar todas as configura√ß√µes de ambiente?")) {
        window.removerFundo();
        
        // Resetar valores
        localStorage.setItem('noir_fundo_posX', '50');
        localStorage.setItem('noir_fundo_posY', '50');
        localStorage.setItem('noir_fundo_zoom', '100');
        
        window.ajustarOpacidadeFicha("0.9");
        window.ajustarOpacidadeFundo("1");
        
        // Atualizar interface
        document.getElementById('opacidadeFicha').value = "0.9";
        document.getElementById('opacidadeFundoImg').value = "1";
        document.getElementById('posicaoX').value = 50;
        document.getElementById('posicaoY').value = 50;
        document.getElementById('zoomFundo').value = 100;
        
        window.aplicarConfiguracoesFundo();
        alert("Configura√ß√µes resetadas.");
    }
};

// === SISTEMA DE SOM DE CLIQUE ===
document.addEventListener('DOMContentLoaded', function() {
    const hoverSound = document.getElementById('hover-sound');
    
    // Configura volume
    if(hoverSound) {
        hoverSound.volume = 0.3;
    }
    
    // Adiciona evento de CLIQUE a TODOS os bot√µes
    document.addEventListener('click', function(e) {
        if(e.target.tagName === 'BUTTON' && hoverSound) {
            hoverSound.currentTime = 0;
            hoverSound.play().catch(() => {});
        }
    });
});


function atualizarIdentidadeNoir() {
    const usuarioAtual = localStorage.getItem('usuarioLogado') || "DESCONHECIDO";
    const el = document.getElementById('display-username');
    if (el) {
        el.innerText = usuarioAtual.toUpperCase();
    }
}

// === AJUSTAR POSI√á√ÉO DO FUNDO ===
window.ajustarPosicaoFundo = function() {
    const x = document.getElementById('posicaoX').value;
    const y = document.getElementById('posicaoY').value;
    const zoom = localStorage.getItem('noir_fundo_zoom') || '100'; // Pega o zoom salvo
    
    document.getElementById('valorX').innerText = x + '%';
    document.getElementById('valorY').innerText = y + '%';
    
    document.body.style.backgroundPosition = `${x}% ${y}%`;
    document.body.style.backgroundSize = `${zoom}%`; // Garante que o zoom permane√ßa
    
    localStorage.setItem('noir_fundo_posX', x);
    localStorage.setItem('noir_fundo_posY', y);
};

// === CENTRALIZAR FUNDO ===
window.centralizarFundo = function() {
    document.getElementById('posicaoX').value = 50;
    document.getElementById('posicaoY').value = 50;
    // Opcional: document.getElementById('zoomFundo').value = 100; 
    window.ajustarPosicaoFundo();
    // window.ajustarZoomFundo(100); // Se quiser resetar o zoom ao centralizar
};

window.ajustarZoomFundo = function(valor) {
    const v = valor || document.getElementById('zoomFundo').value;
    document.getElementById('valorZoom').innerText = v + '%';
    
    // Aplica o tamanho. Usamos o valor em % para background-size
    document.body.style.backgroundSize = `${v}%`;
    
    // Salva no localStorage
    localStorage.setItem('noir_fundo_zoom', v);
};



// Garante que rode ao carregar a ficha
window.addEventListener('load', atualizarIdentidadeNoir);



// Chama a renderiza√ß√£o das per√≠cias
renderPericias();

// Procura o valor inicial de N√≠vel de Cr√©dito para atualizar a caixinha assim que carregar
const inputCredito = document.getElementById('p-val-N√≠vel-de-Cr√©dito');
if (inputCredito) {
    atualizarPadraoVida(inputCredito.value);
}



// Inicializa√ß√£o (Certifique-se que estas linhas existam e estejam fora de outras fun√ß√µes)
renderPericias();
if (typeof addWeaponRow === "function") addWeaponRow(); 
atualizarTudo();



renderPericias();
addWeaponRow(); 
atualizarTudo();
</script>
</body>
</html>
